var zmPhotoLightbox=(function(){var m="/jpt/ajx/"+zmConfig.viewerName+"/zme2/getphoto",G="/jpt/ajx/"+zmConfig.viewerName+"/zme2/getphotos",w="/jpt/ajx/"+zmConfig.viewerName+"/photo2/delete",z="/jpt/ajx/"+zmConfig.viewerName+"/zme2/login",p=36,A,D,g,a={},t={},o,f={},y,k,F,r,I,d;function l(){A=new zm.PhotoViewer({photoHeader:'<a id="photolbx_btnlike" href="#" style="display: none"><span class="photolbx_sprt icophoto likephoto"></span><span class="label">Thích</span></a>				<a id="photolbx_btntag" href="#" style="display: none"><span class="photolbx_sprt icophoto tagphoto"></span>Tag bạn bè</a>				<a id="photolbx_btnrepost" href="#" style="display: none"><span class="photolbx_sprt icophoto repostphoto"></span>Đăng lại</a>				<a id="photolbx_btnreport" href="#" style="display: none"><span class="photolbx_sprt icophoto badreportphoto"></span>Báo xấu</a>				<a id="photolbx_btnsetting" href="#" style="display: none"><span class="photolbx_sprt icophoto settingphoto"></span>Chức năng</a>				<ul id="photolbx_settinglist" class="subact" style="display: none">					<!--<li><a id="photolbx_edit" href="#"><span class="photolbx_sprt icophoto editphoto"></span>Chỉnh sửa ảnh</a></li>-->					<li><a href="#"><span class="photolbx_sprt icophoto delphoto"></span>Xóa</a></li>				</ul>',photoFooter:false,rightContent:'<div id="photolbx_info" style="visibility: hidden">					<div class="righttop">						<div id="photolbx_owner" class="topuserphoto">							<a class="avtuserphoto"><img src="" alt="" /></a>							<div class="nameuserphoto">								<a class="name" href="#"></a>								<p>đăng ảnh<span class="mardot">·</span><span id="photolbx_posttime"></span></p>							</div>						</div>						<div class="textagphoto" style="display: none"></div>						<div class="viewactphoto">							<div class="fl">								<a id="photolbx_btnlikeright" href="#"><span class="photolbx_sprt icophoto likephotort"></span><span class="label">Thích</span></a><span class="mardotbig">·</span>								<a id="photolbx_btnrepostright" href="#"><span class="photolbx_sprt icophoto sharephotort"></span>Đăng lại</a>							</div>							<div class="fr">								<a id="photolbx_likecount" class="linkblack" href="#" style="display: none">Thích</a>							</div>							<div class="clr"></div>						</div>					</div>					<div id="photolbx_cmts"></div>					<div class="rightbottom rowcmtphoto wrtcmtphoto" data-submitbutton="#photolbx_sendcmt">						<div class="avtsmlphoto"><a href="'+zmConfig.PROFILE_URL+"/"+zmConfig.viewerName+'"><img src="'+zmConfig.viewerAva50+'" alt="" /></a></div>						<div class="bxwrtcmtphoto">							<textarea id="photolbx_txt" cols="" rows="" placeholder="Bạn nghĩ gì về ảnh này..." data-required="true"></textarea>						</div>						<div class="rowactcmtphoto">							<span class="rowactcmtphoto_rt"><a href="#"><span class="photolbx_sprt icoemophoto" id="photolbx_emotion" rel="for_photolbx_txt"></span></a><a id="photolbx_sendcmt" class="zmbtn01 disable" href="#">Gửi</a></span>							<span class="rowactcmtphoto_lt">Shift+Enter để xuống dòng</span>						</div>					</div>				</div>',coverClass:"photolbx_pad",onresize:function(){zmPhotoLightbox.Comment.resize();zmPhotoLightbox.Tag.resize()},back:function(){i(-1)},forward:function(){i(1)},afterHide:C});zm("#"+A.getId()+" .stagephoto").append('<div class="descriptionphoto">				<div class="titlephoto">					<h3><em class="photolbx_sprt icoalbum"></em><label id="photolbx_albumname"></label></h3>					<span id="photolbx_index"></span>				</div>				<p class="desphoto" style="overflow: hidden; max-height: '+p+'px; transition: all ease .2s; -webkit-transition: all ease .2s; display: none">					<a id="photolbx_expdesc" href="#" class="photolbx_sprt icomoredes" style="display: none"></a>					<span id="photolbx_desc"></span>				</p>			</div>');H();zmPhotoLightbox.Like.init();zmPhotoLightbox.Comment.init();zmPhotoLightbox.Share.init()}function H(){zm("#photolbx_btnreport").click(function(){k&&zmCommon.reportAbuse(5,"","http://me.zing.vn/jpt/photodetail/"+f[k[y]].user_name+"/"+k[y]+"?from=lb");return false});zm("#photolbx_btnsetting").click(function(){var K=zm("#photolbx_settinglist");if(K.is(":hidden")){K.css("max-height","0px").show().css("max-height","70px")}else{K.hide()}return false}).clickOutside(function(){zm("#photolbx_settinglist").hide()},0,true).clickOutsideWith(zm("#photolbx_settinglist").css({overflow:"hidden",transition:"max-height .8s ease"}));zm("#photolbx_settinglist").click(function(){var K=zm(this);if(K.hasClass("delphoto")||K.find(".delphoto").length){if(k&&k[y]){zm.Boxy.confirm("Bạn có muốn xóa ảnh này không?",function(){var L=k[y];zm.post(w,{pid:k[y],sign:zmConfig.signkey,ts:zmConfig.time,oname:o},{dataType:"json"},function(N){if(N.error==0){i(1);var M=zm.inArray(L,k);M>-1&&k.splice(M,1);if(k==0){zmPhotoLightbox.hideLightbox();if(zmConfig.pageName=="home"||zmConfig.pageName=="profile"){location.reload()}}}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000)}})},{title:"Xóa ảnh",cancelButton:"Hủy bỏ"})}return false}});zm("#"+A.getId()+" .descriptionphoto").click(function(K){K.stopPropagation()});zm("#"+A.getId()+" .stagephoto").hover(function(){if(F){F=false}else{b()}},x).find(".descriptionphoto").mouseenter(b);zm("#photolbx_expdesc").click(function(){g&&clearTimeout(g);var K=zm(this),M=K.parent(),L;if(K.hasClass("off")){L=p;K.removeClass("off")}else{if(M.height()<M[0].scrollHeight){L=M[0].scrollHeight;K.addClass("off")}}M.css("max-height",L+"px");return false});c()}function c(){zm(window).bind("popstate",function(K){if(K.state&&K.state.pid>0){q(K.state.pid,a[K.state.pid])}else{A.hide()}})}function v(K,L){if("http://"+location.host!=zmConfig.ME_URL){return}if(!history.pushState||!A.isShowing()){return}if(!d){d=location.href}history.pushState({pid:K},null,zmConfig.ME_URL+"/jpt/photodetail/"+L+"/"+K)}function j(K){if(K<0){K+=k.length}else{if(K>=k.length){K-=k.length}}return K}function s(K){if(!k){return}K=j(K);return k[K]}function i(K){if(!k||k.length<2){return}F=false;y+=K;y=j(y);if(!a[k[y]]){h()}v(k[y],(f[k[y]]&&f[k[y]].user_name)||o);q(k[y],a[k[y]]);e(K)}function E(K,M,L){var N={pid:K,sign:zmConfig.signkey,ts:zmConfig.time,oname:o};if(M){N.type=M}if(L){N.aid=L}zm.get(m,N,{dataType:"json"},function(P){if(P.error==0){k=P.data.ids;y=P.data.index;var O=P.data.photos[P.data.pid];D=P.data.pid;a[P.data.pid]=O;f[P.data.pid]=O.album;delete a[P.data.pid].album;v(P.data.pid,o);zm("#"+A.getId()).show();zm("#photolbx_login").hide();q(P.data.pid,O);e(true)}else{if(P.error==3){zm("#"+A.getId()).before(P.data).hide();zm("#photolbx_login .ctnpw").css("margin-top",((zm("#photolbx_login").parent().height()-238)/2)+"px");zm("#photolbx_login .photo_login_btn").addClass("disable");zm("#photolbx_login .photo_pass").focus();zm("#photolbx_login .photo_login_btn").click(B);zm("#photolbx_login input").keyup(function(S){var Q=zm("#photolbx_login .photo_capt").val(),R=zm("#photolbx_login .photo_pass").val();zm("#photolbx_login .photo_login_btn")[Q&&R?"removeClass":"addClass"]("disable");if(S.keyCode==13){B();return false}})}else{if(P.error==1){A.setPhotoSize(529,396);A.setPhoto("http://static.me.zing.vn/v4/images/zmphoto/lbx_delete.jpg")}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000)}}}})}function e(N){var P=[];if(N===true){var L=s(y-1);if(!a[L]){P.push(L)}var K=s(y+1);if(!a[K]){P.push(K)}}else{if(zm.isNumber(N)){var O=s(y+N);if(!a[O]){P.push(O)}}}if(P.length<1){return}var M={pids:P.join(","),sign:zmConfig.signkey,ts:zmConfig.time,oname:o};if(r){M.type=r}zm.get(G,M,{dataType:"json"},function(U){u();for(var S in U.data){if(U.data[S].album){f[S]=U.data[S].album;delete U.data[S].album}a[S]=U.data[S];delete t[S];var R=new Image();R.onload=function(){a[S].w=this.width;a[S].h=this.height;t[S]=true};var Q=A.getPhotoSize(a[S].w,a[S].h),T=a[S].url;if(Q.width>=720||Q.height>=720){T=T.replace("_574_574.",".")}R.src=T;if(R.complete){a[S].w=R.width;a[S].h=R.height;t[S]=true}}})}function q(N,O){if(!O){return}zmPhotoLightbox.Tag.get();var L=f[N]||f[D];if(O.desc){if(!O.processed){O.desc=O.desc.replace(/\n/g,"<br />");O.desc=zm.detectLink(O.desc,{target:"_blank"});O.processed=true}zm("#photolbx_desc").html(O.desc).parent().css("max-height",p+"px");setTimeout(function(){var Q=zm("#photolbx_desc").parent().show();if(Q[0].scrollHeight>p){zm("#photolbx_expdesc").show().removeClass("off")}else{zm("#photolbx_expdesc").hide()}Q.css("visibility","").css("max-height",p+"px").css("margin-bottom","").show()},0);g&&clearTimeout(g);g=setTimeout(x,5000)}else{zm("#photolbx_desc").empty().parent().hide()}zm("#photolbx_edit").attr("href",zmConfig.ME_URL+"/jpt/photodetail/"+L.user_name+"/"+N);var M=A.getPhotoSize(O.w,O.h),P=O.url;if(M.width>=720||M.height>=720){P=P.replace("_574_574.",".")}n(N,P);if(t[N]){A.setPhotoSize(O.w,O.h);A.setPhoto(P)}zm("#photolbx_albumname").html('<a href="http://me.zing.vn/jpt/albumdetail/'+L.user_name+"/"+L.id+'">'+L.name+"</a>");zm("#photolbx_index").text((y+1)+"/"+k.length);A[k.length>1?"enableNavigation":"disableNavigation"]();var K=L.user_name==zmConfig.viewerName;zm("#photolbx_btnreport")[(K||zm.intval(zmConfig.viewerId)<=0)?"hide":"show"]();zm("#photolbx_btnsetting")[(K&&zmConfig.viewerId>0)?"show":"hide"]();zm("#photolbx_owner .avtuserphoto").attr("href",zmConfig.PROFILE_URL+"/"+L.user_name).find("img").attr("src",L.avatar);zm("#photolbx_owner .name").attr("href",zmConfig.PROFILE_URL+"/"+L.user_name).text(L.display_name);zm("#photolbx_posttime").attr("rel",O.date);zmDateTime.add(["photolbx_posttime"],true);zm("#photolbx_owner").css("visibility","");zm("#photolbx_info").css("visibility","");zm("#photolbx_info .textagphoto").hide();zmPhotoLightbox.Like.render(O.vote);zmPhotoLightbox.Comment.render(O.comment);zmPhotoLightbox.Share.render();zmPhotoLightbox.Comment.resize()}function n(L,M){delete t[L];var K=new Image();K.pid=L;K.onload=function(){if(this.pid&&a[this.pid]){t[this.pid]=true}A.setPhotoSize(this.width,this.height);A.setPhoto(this.src)};K.src=M;if(K.complete){A.setPhotoSize(a[L].w,a[L].h);A.setPhoto(M)}}function C(){A.setPhoto("");zm("#photolbx_albumname").empty();zm("#photolbx_desc").empty().parent().hide();zm("#photolbx_edit").attr("href","#");zm("#photolbx_index").text("");zm("#photolbx_info").css("visibility","hidden");zm("#photolbx_owner").css("visibility","hidden");zm("#"+A.getId()).show();zm("#photolbx_login").hide();zmPhotoLightbox.Comment.clear();zmPhotoLightbox.Like.clear();zmPhotoLightbox.Tag.clear();F=false;D=null;r="";a={};d&&history.pushState({},null,d);d=null}function J(M,K,L){if(L.indexOf("http://static.me.zing.vn")<0){A.setPhotoSize(M,K);A.setPhoto(L)}}function h(){I=true}function u(){I=false}function b(){g&&clearTimeout(g);var K=zm("#photolbx_desc");K.html()&&K.parent().css("max-height","0px").show();setTimeout("zm('#photolbx_desc').parent().css('max-height', '"+p+"px').css('margin-bottom', '')",0)}function x(){zm("#photolbx_desc").parent().css("max-height","0px").css("margin-bottom","0px");zm("#photolbx_expdesc").removeClass("off")}function B(){var K=zm("#photolbx_login .photo_capt").val(),L=zm("#photolbx_login .photo_pass").val();if(K&&L){}else{return false}zm.post(z,{sign:zmConfig.signkey,ts:zmConfig.time,data:zm("#photolbx_login .photo_data").val(),capt:zm("#photolbx_login .photo_capt").val(),pass:zm("#photolbx_login .photo_pass").val()},{dataType:"json"},function(M){if(M.error==0){zm("#photolbx_login").hide();zm("#"+A.getId()).show();E(D,r,D)}else{zm.Boxy.alert(M.msg,"Thông báo")}});return false}return{showLightbox:function(M,Q,P,K,L,O,N){try{if(!A){l()}F=true;D=M;A.show();o=Q;r=O;N?E(M,O,M):E(M,O);J(P,K,L)}catch(R){zm.log(R.stack||R)}},hideLightbox:function(){A.hide();o="";k=null;y=null;F=false;return false},getCurPhotoId:function(){if(!k){return}return k[y]},getCurOwner:function(){return o},back:function(){i(-1)},forward:function(){i(1)},setLikedCache:function(K,L){if(a[K]&&a[K].vote){a[K].vote.voted=L}}}})();zm.ready(function(){zm("head").append(zm.createElement("link",{rel:"stylesheet",type:"text/css",href:zmConfig.CSS_URL+"/photolbx-1.10.css"}));zm(document.body).click(function(){var m=this;var f=zm(m).parents(".ptlbx");if(f.length>0){var k=unescape(f.attr("pdata")).split(",");zmPhotoLightbox.showLightbox(k[1],k[0],k[3],k[4],k[5],k[2]);return false}if(m&&m.nodeName.toLowerCase()!="a"){m=m.parentNode}if(!m||m.nodeName.toLowerCase()!="a"){return}var a=zm(m).attr("href");if(!a){return}var j=a.substr(a.indexOf("?")+1).split("?");if(j.length<2){return}var d=j[0].split("/"),h=zm.intval(d[d.length-1]);if(h<=0){return}var l=d[1],c=d[3]=="my-album";j=j[1].split("&");var e={};for(var g=0,n;n=j[g];g++){var b=n.split("=");if(!b||b.length<2){continue}e[b[0]]=b[1]}zmPhotoLightbox.showLightbox(h,l,e.w,e.h,zm(m).find("img").attr("src"),null,c);return false})});zmPhotoLightbox.Comment=(function(){var f="/jpt/ajx/"+zmConfig.viewerName+"/comment2/get",g="/jpt/ajx/"+zmConfig.viewerName+"/comment2/remove",j="/jpt/ajx/"+zmConfig.viewerName+"/comment2/post",l=5,c,m=0,h;function e(q){if(!c){c=new zm.ScrollableUI({width:320,content:'<div id="photolbx_morecmt" class="rowcmtphoto" style="display: none">				<div class="rowviewcmtphoto">					<a href="#">Xem thêm<span id="photolbx_morecmtstep"> 5</span> bình luận <span class="feed_sprt icomorecmt"></span></a>					<img alt="" src="'+zmConfig.IMAGE_URL+'/loading/loading_32.gif" class="ctnloading" style="display: none; vertical-align: top;" />				</div>			</div>			<div id="photolbx_cmtlist"></div>'});zm("#photolbx_cmts").append(c.getElement());zm("#photolbx_morecmt a").click(function(){a();return false});zmPhotoLightbox.scrollComments=c}zm("#photolbx_cmtlist").prepend(q.html);var n=[];for(var p=0,o;o=q.cmids[p];p++){n.push("photo_cmt_"+o+" .time");zm("#photo_cmt_"+o+" .content").renderEmotions();i(o)}h=q.lastId;var r=zm("#photolbx_cmtlist").children().length;if(q.total>r){zm("#photolbx_morecmtstep").text(" "+Math.min(l,q.total-r))}else{zm("#photolbx_morecmtstep").text("")}zm("#photolbx_morecmt")[(r>=q.total||h==0)?"hide":"show"]();zmDateTime.add(n,true)}function i(n){zm("#photo_cmt_"+n+" .reply").click(function(){zm("#photolbx_txt").insertAtCaret("@"+this.rel+": ");return false});zm("#photo_cmt_"+n).hover(function(){zm(this).find(".replyphoto").show()},function(){zm(this).find(".replyphoto").hide()});zm("#photo_cmt_"+n+" .optgroup").click(function(){zm(this).parents(".rowcmtphoto").find(".selopt").toggle();return false});zm("#photo_cmt_"+n+" .optdelete").click(function(){var o=zmPhotoLightbox.getCurPhotoId(),p=zm.intval(zm(this).attr("rel"));if(o<=0||p<=0){return false}zm.Boxy.confirm("Bạn có muốn xóa bình luận này không?",function(){zm.post(g,{pid:o,cid:p,sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(q){if(q.error==0){zm("#photo_cmt_"+p).remove()}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000)}})},{title:"Xóa bình luận",okButton:"Đồng ý",cancelButton:"Hủy bỏ"});return false})}function a(){if(h==0){return}b();zm.post(f,{pid:zmPhotoLightbox.getCurPhotoId(),cid:h,sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(n){d();e(n.data)})}function b(){zm("#photolbx_morecmt .ctnloading").show()}function d(){zm("#photolbx_morecmt .ctnloading").hide()}function k(){zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",2000,{afterHide:function(){zm("#photolbx_txt").focus();zm("#photolbx_sendcmt").removeClass("disable")}})}return{init:function(){zm("#photolbx_txt").keypress(function(n){if(!n.shiftKey&&n.keyCode==13){zm("#photolbx_sendcmt").click();return false}}).keyup(function(n){this.value&&n.stopPropagation()}).autoResize({onresize:function(n,o){if(n>=104){zm(this).css("overflow-y","auto");return false}zm(this).css("overflow-y","");zmPhotoLightbox.Comment.resize(o-n)}}).tagFriend(zm("#photolbx_txt").parent()[0],{zIndex:52});zm("#photolbx_sendcmt").click(function(){if(zm(this).hasClass("disable")){return false}var n=zm.trim(zm("#photolbx_txt").val());if(!n){return false}zm("#photolbx_txt").attr("disabled",true);zm(this).addClass("disable");zm.post(j,{pid:zmPhotoLightbox.getCurPhotoId(),msg:n,sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(p){var o=zm("#photolbx_txt").attr("disabled",false);if(p.error!=0){k()}else{o.val("").focus();m++;if(p.data){var q=zm("#photolbx_cmtlist").append(p.data).children().get(":last").attr("id").substr(10);zmDateTime.add("photo_cmt_"+q+" .time");zm("#photo_cmt_"+q+" .content").renderEmotions();i(q);setTimeout(function(){c.scrollToEnd()},100)}}},k);return false});zm("#photolbx_emotion").attachEmoButtons();zm("#photolbx_info .rightbottom").handleInput()},render:function(n){m=n.total;if(m>l){zm("#photolbx_morecmtstep").text(" "+Math.min(l,m-l))}else{zm("#photolbx_morecmtstep").text("")}zm("#photolbx_cmtlist").empty();zm("#photolbx_txt").val("").focus();e(n);zm("#photolbx_info .wrtcmtphoto")[zmConfig.viewerId>0?"show":"hide"]()},resize:function(n){if(!c){return}var o=zm("#photolbx_cmts").parents(".photolbx_cont");c.setMaxHeight(o.height()-(zm("#photolbx_info .righttop").offset(true).top-o.offset(true).top)-zm("#photolbx_info .righttop").outerHeight(true)-zm("#photolbx_info .rightbottom").outerHeight(true)+zm.intval(n))},clear:function(){zm("#photolbx_cmtlist").empty();zm("#photolbx_morecmt").hide()}}})();zmPhotoLightbox.Like=(function(){var l="/jpt/ajx/"+zmConfig.viewerName+"/vote2/",m,b=1,i,e=0,h;function g(n){f(zm("#photolbx_btnlike span"),n,"likedphoto");f(zm("#photolbx_btnlikeright span.icophoto"),n,"likedphotort");zmPhotoLightbox.setLikedCache(zmPhotoLightbox.getCurPhotoId(),n)}function f(o,p,n){var q="";if(p){o.addClass(n);q="Bỏ thích"}else{o.removeClass(n);q="Thích"}o.parent().find(".label").text(q)}function j(){i=true;zm.get(l+"more",{pid:zmPhotoLightbox.getCurPhotoId(),page:b,sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(n){i=false;d();if(n.data){m.show();zm("#photo_likedlist").append(n.data);zm("#photo_moreliked")[zm("#photo_likedlist").children().length<e?"show":"hide"]()}})}function c(){if(!zm("#photo_likedloading").length){zm("#photo_moreliked").append('<div id="photo_likedloading" style="text-align: center;padding: 11px;"><img src="'+zmConfig.IMAGE_URL+'/loading/loading_32.gif"></div>')}else{zm("#photo_likedloading").show()}zm("#photo_moreliked .zmpubotbar").hide()}function d(){zm("#photo_likedloading").hide();zm("#photo_moreliked .zmpubotbar").show()}function a(){if(e<1){zm("#photolbx_likecount").hide()}else{zm("#photolbx_likecount").html(e+" Thích").show()}}function k(o){var n=zmPhotoLightbox.getCurPhotoId();if(!n){return}g(!o);e+=o?-1:1;a();zm.post(l+(o?"unset":"set"),{pid:n,oname:zmPhotoLightbox.getCurOwner(),sign:zmConfig.signkey,ts:zmConfig.time},{dataType:"json"},function(p){})}return{init:function(){zm("#photolbx_likecount").click(function(){zmPhotoLightbox.Like.showList();return false});zm("#photolbx_btnlike").click(function(){k(zm("#photolbx_btnlike span").hasClass("likedphoto"));return false});zm("#photolbx_btnlikeright").click(function(){k(zm("#photolbx_btnlikeright span.icophoto").hasClass("likedphotort"));return false})},render:function(n){e=n.total;a();g(n.voted);zm("#photolbx_btnlikeright")[zmConfig.viewerId>0?"show":"hide"]();zm("#photolbx_btnlikeright").next()[zmConfig.viewerId>0?"show":"hide"]();zm("#photolbx_btnlike")[zmConfig.viewerId>0?"show":"hide"]()},showList:function(){if(!m){var n=new zm.ScrollableUI({content:'<ul id="photo_likedlist" class="ui_listrow zmlikelist"></ul>					<div id="photo_moreliked" class="zmpubot" style="display: none">						<div class="zmpubotbar">							<a class="morelink" href="#">Xem thêm<em></em></a>						</div>					</div>',width:350,height:350,onscroll:function(q,p,o){if(i){return}if(o==1){c();h&&clearTimeout(h);h=setTimeout("zm('#photo_moreliked').click()",200)}}});m=new zm.Boxy({title:"Những người thích ảnh này",content:n.getElement(),zIndex:100,footer:false,hideOnClickOutside:true});zm("#photo_moreliked").click(function(){if(i){return}c();b++;j();return false});zm("#photo_likedlist").on("click",".makefriend",function(){var p=this,o=zm.intval(zm(this).attr("rel"));o>0&&zmFriendRequests.sendRequest(o,function(){zm(p).parent().html("<em>Đã gửi</em>")},{check_avatar:1,source:147})})}else{zm("#photo_likedlist").empty();zm("#photo_moreliked").hide()}b=1;j()},clear:function(){zm("#photolbx_likecount").hide()}}})();zmPhotoLightbox.Tag=(function(){var a="/jpt/ajx/"+zmConfig.viewerName+"/zme2/gettags",d,c={};function b(j){if(!j.tags||j.tags.length<1){zm("#photolbx_info .textagphoto").hide();return}zm("#photolbx_info .textagphoto").show();var h=zm("#photolbx_info .textagphoto").width()||280;if(!d){d=new zm.ScrollableUI({width:h,maxHeight:90});zm("#photolbx_info .textagphoto").append(d.getElement())}var g=[];for(var f=0,e;e=j.tags[f];f++){g.push('<a href="'+zmConfig.PROFILE_URL+"/"+e.user.user_name+'" target="_blank">'+e.user.display_name+"</a>")}d.setContent("cùng với "+g.join(", "));setTimeout(zmPhotoLightbox.Comment.resize,0)}return{get:function(){var e=zmPhotoLightbox.getCurPhotoId();if(!e){return}if(c[e]){b(c[e]);return}zm.post(a,{pid:e,sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(f){if(!f.data){return}c[e]=f.data;b(f.data)})},resize:function(){if(!d){return}var e=zm("#photolbx_info .textagphoto").width();e>0&&d.setWidth(e)},clear:function(){c={};d&&d.empty();zm("#photolbx_info .textagphoto").hide()}}})();zmPhotoLightbox.Share=(function(){var b="/jpt/ajx/"+zmConfig.viewerName+"/photo2/sharepopup",a="/jpt/ajx/"+zmConfig.viewerName+"/photo2/share",d,c;function e(){d=new zm.Boxy({title:"Đăng lại ảnh này",content:'<div class="sharefeed_form">					<div class="sharemsg">						<div class="txtarea">							<div class="zmemoticon">								<a class="zmsmiley_ico zmico" rel="for_photolbx_sharetxt" id="photolbx_shareemo" title="Chèn biểu tượng vui" href="#"></a>							</div>							<textarea id="photolbx_sharetxt" placeholder="Chia sẻ cảm nghĩ của bạn" required></textarea>						</div>					</div>					<div id="photolbx_sharecont"></div>				</div>',boxyClass:"pu_large",okButton:"Đăng lại",cancelButton:"Hủy bỏ",zIndex:55,onOk:function(){d.showLoading();zm.post(a,{pid:c,msg:zm("#photolbx_sharetxt").val(),sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(f){d.hideLoading();if(f.error==0){d.hide()}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",3000)}});return false}});zm("#photolbx_shareemo").attachEmoButtons()}return{init:function(){zm("#photolbx_btnrepost").click(zmPhotoLightbox.Share.getContent);zm("#photolbx_btnrepostright").click(zmPhotoLightbox.Share.getContent)},getContent:function(f){if(!zm.isNumber(f)){f=zmPhotoLightbox.getCurPhotoId()}c=f;zm.get(b,{pid:f,sign:zmConfig.signkey,ts:zmConfig.time,oname:zmPhotoLightbox.getCurOwner()},{dataType:"json"},function(g){if(g.error==0&&g.data){if(!d){e()}zm("#photolbx_sharecont").html(g.data);d.show();zm("#photolbx_sharetxt").focus()}else{zm.Boxy.alert("Có lỗi xảy ra, vui lòng thử lại sau.","Thông báo",3000)}});return false},render:function(){zm("#photolbx_btnrepost")[zmConfig.viewerId>0?"show":"hide"]();zm("#photolbx_btnrepostright")[zmConfig.viewerId>0?"show":"hide"]()},post:function(){}}})();if(typeof swfobject=="undefined"){zm.addScript("http://static.me.zing.vn/v3/js/swfobject.js")}var zupload=(function(){var ac=function(al,ak,am){var ao=new Image();var an=0;new f(al,ak,am);setTimeout(function(){},100);ao.onload=function(){zm("#zf_url_"+al).css("background-image","url("+ak+(an>0?"?"+(new Date()).getTime():"")+")")};ao.onerror=function(){var ap=this;if(++an<20){setTimeout(function(){ap.src=ak+"?"+(new Date()).getTime()},500)}};setTimeout(function(){ao.src=ak+"?"+(new Date()).getTime()},500)};var f=function(am,al,ao){function aq(ar){var at=zm.trim(this.value);if(at!=""){N["desc_"+ao]=at}V(this,500,zm("#zf_count_"+am))}function ak(at){at.preventDefault();var ar=zm("#zf_cover_"+am);if(ar.hasClass("lbselected")){return}if(N.albumCoverPos!=undefined){zm("#zf_cover_"+N.albumCoverPos).removeClass("lbselected").html("")}N.albumCover=ao;N.albumCoverPos=am;ar.addClass("lbselected").html("<em></em>")}function ap(ar){ar.preventDefault();zm.Boxy.alert("Tính năng đang xây dựng.","Thông báo")}function an(ar){ar.preventDefault();if(totalSuc-totalDel==1){return zm.Boxy.alert("Album phải có ít nhất 1 ảnh.","Thông báo",3000)}zm("#zf_"+am).remove();T(ao)}zm("#zf_desc_"+am).bind("keyup",aq);zm("#zf_cover_"+am).click(ak);zm("#zf_edit_"+am).click(ap);zm("#zf_delete_"+am).click(an)};function V(al,ak,am){am.parent().show();if(al.value.length>ak){al.value=al.value.substring(0,ak-1);am.html(0)}else{am.html(ak-al.value.length)}}var ag="/jpt/ajx";var E="ts/"+zmConfig.currenttime+"/sign/"+zmConfig.signkey;var aj="ZPhotoUpload",I="ZPhotoUpload2",G="ZPhotoUpload3",F="ZPhotoUpload4",u=null,ad=null,N={},af={},x=0;totalSuc=0,totalFail=0,totalDel=0;var v={};var A={};var e=null;var L='<div id="zupload_main" style="display:none" class="fixedbox_overlay">			<div class="fixedbox_wrapper photoalb_create">				<div class="fixedbox_body">					<div class="fixedbox_top">						<div class="fixedbox_title">							<div class="fbxpad">								<div class="fixedbox_close"><a id="zupload_close" href="#" title="Hủy"></a></div>								<p class="fixedbox_titletext">Đăng ảnh và chia sẻ ảnh</p>								<div class="clr"></div>							</div>							<div class="clr"></div>						</div>						<div class="album_topfuncs">							<div class="rightfunc albtype">								<a href="#" id="zupload_popcate_tg"><span class="linkicon"></span><strong>Chọn thể loại</strong><em></em></a>							</div>							<div class="rightfunc albprivacy">								<a href="#" id="zupload_popprivacy_tg"><span class="linkicon"></span><strong>Quyền xem album</strong><em></em></a>							</div>							<div class="rightfunc albdesc">								<a href="#" id="zupload_popinfo_tg"><span class="linkicon"></span><strong>Thông tin mô tả</strong><em></em></a>							</div>							<div class="albname">								<p class="albname_txt"><input id="album_name" type="text" placeholder="Đặt tên album" class="txtinput" /></p>								<!--<a href="#" class="available_album"><span class="icon"></span>Chọn album có sẵn<em></em></a>-->							</div>							<div class="clr"></div>						</div>					</div>					<div id="zupload_main_scroll" class="fixedbox_content fbxpad">					</div>				</div>				<div class="fixedbox_footer">					<div class="fixedbox_botcont fbxpad">						<p class="bottom_btn"><a id="ZPhotoUpload_Z2"></a><a id="zupload_addphoto_z" class="zmbtn02 addmorephoto_btn" href="#">Thêm ảnh</a><a id="zupload_finish" style="display:none;" class="zmbtn01" href="#">Tạo album</a><a id="zupload_finish_dis" style="display:none;" class="zmbtn01 disable" href="#">Tạo album</a></p>						<p class="bottom_link">							Tải xong <strong><span id="zupload_count">0</span>/<span id="zupload_total">0</span></strong> ảnh						</p>						<p class="totalprogressbar">							<strong class="percentcount"><strong id="zupload_percent_count">0</strong>%</strong>							<span><em id="zupload_percent" style="width:0%;"></em></span>						</p>						<div class="clr"></div>					</div>				</div>			</div>		</div>';var D='<div class="ctndisbox disbox_albname" style="display:none" id="zupload_poplist">			<div class="disbox_inner"><span class="icodisbox topright"></span>				<div class="disbox">					<div class="contdisbox">						<ul class="albname_list">							<li><a href="#">Landscape</a></li>						</ul>					</div>				</div>			</div>		</div>		<div class="ctndisbox disbox_albprivacy" style="display:none" id="zupload_popprivacy">			<div class="disbox_inner"><span class="icodisbox topright"></span>				<div class="disbox">					<div class="contdisbox">						<p class="box_abltitle">Ai được quyền xem album</p>						<div class="albfunc_cont">							<p class="pivacty_settings" id="album_privacy">								<input type="radio" value="7" id="c_p7" name="c_privacy" checked="checked" />								<label for="c_p7"><span class="radio"></span>Tất cả</label>								<input type="radio" value="3" id="c_p3" name="c_privacy" />								<label for="c_p3"><span class="radio checked"></span>Bạn bè</label>								<input type="radio" value="1" id="c_p1" name="c_privacy" />								<label for="c_p1"><span class="radio"></span>Chỉ mình tôi</label>								<input type="radio" value="0" id="c_p0" name="c_privacy" />								<label for="c_p0"><span class="radio"></span>Cài mật khẩu</label>							</p>							<div class="alb_setpassword" style="display:none" id="album_pass">								<p>									<label class="flabel">Nhập mật khẩu:</label>									<input id="album_pass1" type="password" class="txtinput txtalbpass" />								</p>								<p>									<label class="flabel">Nhập lại mật khẩu:</label>									<input id="album_pass2" type="password" class="txtinput txtalbpass" />								</p>							</div>							<p class="bottombtn"><a class="zmbtn02 album_save" href="#">Lưu</a></p>						</div>					</div>				</div>			</div>		</div>		<div class="ctndisbox disbox_albdesc" style="display:none" id="zupload_popinfo">			<div class="disbox_inner"><span class="icodisbox topright"></span>				<div class="disbox">					<div class="contdisbox">						<p class="box_abltitle">Thông tin mô tả album</p>						<div class="albfunc_cont">							<p class="albtextdesc"><textarea id="album_desc" class="textarea" placeholder="Chia sẻ thông tin về album"></textarea></p>							<p class="bottombtn">								<span class="charcounter" style="display:none">Còn <span id="album_count">500</span> ký tự</span>								<a class="zmbtn02 album_save" href="#">Lưu</a>							</p>						</div>					</div>				</div>			</div>		</div>		<div class="ctndisbox disbox_albtype" style="display:none" id="zupload_popcate">			<div class="disbox_inner"><span class="icodisbox topright"></span>				<div class="disbox">					<div class="contdisbox">						<p class="box_abltitle">Chọn thể loại cho album</p>						<div class="albfunc_cont">							<div class="albtype_list">								<ul id="zupload_cates">								</ul>							</div>							<p class="bottombtn">								<a class="zmbtn02 album_save" href="#">Lưu</a>							</p>						</div>					</div>				</div>			</div>		</div>';var aa='<div class="fixedbox_content_inner">							<div class="upwid_thumbimg">								<p class="uploadtip"><strong>Mẹo đăng ảnh:</strong> Nhấn giữ Ctrl hoặc Shift để chọn một lúc nhiều ảnh. Bạn có thể đăng tối đa <strong><span id="zupload_remain">100</span></strong> ảnh.</p>								<ul id="zupload_files"></ul>							</div>						</div>';var C='<li id="#ZF_ID#">							<p class="upwid_loading">								<span class="photoloading_bar"><em id="#ZF_PERCENT#" style="width:1%;"></em></span>							</p>						</li>';var c='<li id="#ZF_ID#">							<a><span id="#ZF_URL#" class="thumbwrapper" style="background:url(http://img.me.zdn.vn/v4/images/loading/loading_64.gif) no-repeat center center;"></span></a>							<p class="photocaption"><textarea id="#ZF_DESC#" placeholder="Chú thích ảnh..." class="texteditupload"></textarea></p>							<p class="quickeditbar" rel="#ZF_PID#">								<a id="#ZF_COVER#" href="#" class="thumb_alblabel" title="Chọn làm ảnh bìa cho album">Chọn làm ảnh bìa cho album</a>								<!--<a id="#ZF_EDIT#" href="#" class="thumb_edit" title="Chỉnh sửa">Chỉnh sửa</a>-->								<a id="#ZF_DELETE#" href="#" class="thumb_del" title="Xóa ảnh">Xóa ảnh</a>								<span class="charcounter fr" style="display:none"><span id="#ZF_COUNT#">500</span> ký tự</span>							</p>						</li>';var H='<li>							<p class="photo_error">								<em class="icon_warning"></em>								<strong>#ERROR#</strong>							</p>						</li>';function X(){zm("#stbox_createalbum").append('<div id="ZPhotoUpload_Z1"></div>')}function ai(){if(zm("#zupload_main").size()>0){return}zm(document.body).append(L);zm("#zupload_main").prepend(D);window.scroll_files=new zm.ScrollableUI({content:aa,onscroll:i});zm("#zupload_main_scroll").append(scroll_files.getElement());zm(scroll_files.getElement()).find(".zmscrollableui_wrapper").css("width","110%");g()}function g(){zm("#zupload_close").click(h);j("zupload_popinfo");j("zupload_popprivacy");j("zupload_popcate");zm("#album_privacy").click(function(){if(z()==0){zm("#album_pass").show()}else{zm("#album_pass").hide()}});B();P();zm("#album_desc").bind("keyup",function(){V(this,500,zm("#album_count"))});zm(window).bind("resize",P);zm("#zupload_finish").click(t);window.onbeforeunload=b}function B(){var ak=ag+"/"+zmConfig.viewerName+"/album2/cates/"+E;zm.get(ak,{dataType:"json"},function(al){if(!al.error){zm("#zupload_cates").append(al.data);var am=zm.cookie("ucate");if(am!=undefined){zm("#c_cate_"+am).attr("checked","checked")}}})}var w="Đăng ảnh chưa hoàn thành. Bạn muốn kết thúc?";function h(ak){ak.preventDefault();if(totalSuc>0){return zm.Boxy.confirm(w,y,{okButton:"Đồng ý",cancelButton:"Hủy bỏ",title:"Thông báo"})}y()}function y(){function ak(){u=null;zm("#zupload_main").hide();window.location.reload()}var am="";if(af.addmore!=undefined){am="/count/"+totalSuc}var al=ag+"/"+zmConfig.viewerName+"/album2/delete/aid/"+af.album_id+am+"/"+E;zm.get(al,{dataType:"json"},function(an){ak()})}function b(){if(u!=null&&u.isUploading()){return w}}function P(){var ak=zm(document.body).height();ak-=156;scroll_files.setHeight(ak)}function j(ak){zm("#"+ak+"_tg").click(function(al){al.preventDefault();if(zm("#"+ak+"_tg").hasClass("selected")){return Y(ak)}U(ak);if(ak=="zupload_popinfo"){zm("#album_desc").focus()}}).clickOutside(function(al){Y(ak)}).clickOutsideWith(zm("#"+ak));zm("#"+ak).find("a.album_save").click(function(ap){ap.preventDefault();if(ak=="zupload_popprivacy"&&z()==0){var am=zm.trim(zm("#album_pass1").val());var al=zm.trim(zm("#album_pass2").val());if(am!=al){var aq=new zm.Boxy({content:"Mật khẩu bạn nhập không giống nhau.",title:"Thông báo",boxyClass:"pu_small"});var an=zm(aq.getElement());function ao(ar){ar.stopPropagation();ar.preventDefault();aq.close("close")}an.find(".submitbtn").click(ao);an.find(".zmpuclose").click(ao);aq.show();return}}Y(ak)})}function Y(ak){var al=zm("#"+ak+"_tg");var am=zm("#"+ak);al.removeClass("selected");am.hide()}function U(ak){var al=zm("#"+ak+"_tg");var am=zm("#"+ak);al.addClass("selected");am.fadeIn();var ao=al.offset().left+al.width()-am.width()+24;var an=al.offset().top+al.height()+10;am.css({left:ao+"px",top:an+"px"})}function p(aq){var ak={urlupload:"http://jupload-photo.apps.zing.vn/ptu/lbupload2/"+zmConfig.viewerName,zulog:(window.location.href.indexOf("zulog")!=-1?true:""),userid:zmConfig.viewerId,username:zmConfig.viewerName};var ap={allowscriptaccess:"always",wmode:"transparent"};var al={id:aj+aq,name:aj+aq,align:"middle"};var an="-1.00";var am=zmConfig.STATIC_URL+"/v4/swf/"+aj+an+".swf";var ao="playerProductInstall.swf";if(aq==""){ak.from=aj;swfobject.embedSWF(am,"ZPhotoUpload_Z1","1","1","10.0.0",ao,ak,ap,al,Q)}else{if(aq=="2"){ak.from=I;swfobject.embedSWF(am,"ZPhotoUpload_Z2","1","1","10.0.0",ao,ak,ap,al,ae)}else{if(aq=="3"){ak.from=G;swfobject.embedSWF(am,"ZPhotoUpload_Z3","1","1","10.0.0",ao,ak,ap,al,ab)}else{if(aq=="4"){ak.from=F;swfobject.embedSWF(am,"ZPhotoUpload_Z4","1","1","10.0.0",ao,ak,ap,al,Z)}}}}}function Q(){zm("#stbox_createalbum").css({position:"relative"});var ak=zm("#stbox_createalbum");zm("#"+aj).css({position:"absolute",left:0,top:0,width:ak.width()+"px",height:ak.height()+"px"}).click(function(al){al.preventDefault()});u=document.getElementById(aj)}function ae(){zm("#zupload_addphoto_z").parent().css({position:"relative"});var ak=zm("#zupload_addphoto_z");zm("#"+I).css({position:"absolute",left:0,top:0,width:ak.outerWidth()+"px",height:ak.outerHeight()+"px"}).click(function(al){al.preventDefault()});ad=document.getElementById(I)}function ab(){zupload.afterInit.call();zm("#"+G).click(function(ak){ak.preventDefault()});u=document.getElementById(G)}function Z(){zupload.afterInit.call();u=document.getElementById(F);zm("#"+F).click(function(ak){ak.preventDefault()});e=u}function z(){return zm("#album_privacy input:checked").val()}function r(){var ak=ag+"/"+zmConfig.viewerName+"/album2/create/"+E;zm.post(ak,{},{dataType:"json"},m)}function m(ak){if(!ak.error){af.album_name=ak.data.album_name;af.album_id=ak.data.album_id;af.hash=ak.data.hash;l()}}function t(ap){ap.preventDefault();var ak=ag+"/"+zmConfig.viewerName+"/album2/updateupload/"+E;var aq=zm.trim(zm("#album_name").val());var am=zm.trim(zm("#album_desc").val());var an=z();var ao="";if(an==0){var at=zm.trim(zm("#album_pass1").val());var ar=zm.trim(zm("#album_pass2").val());if(at!=""&&at==ar){ao=at}else{if(af.album_privacy=="0"){}else{an=7}}}var al=zm("#zupload_cates input:checked").val();if(al==undefined){al=0}zm.cookie("ucate",al,{expires:7});N.albumId=af.album_id;N.albumName=aq;N.albumDesc=am;N.albumPrivacy=an;N.albumPass=ao;N.albumCate=al;N.total=totalSuc-totalDel;N.pos=af.remain+100;zm.post(ak,N,{dataType:"json"},d)}function d(ak){if(!ak.error){window.location.href="http://me.zing.vn/jpt/albumdetail/"+zmConfig.viewerName+"/"+af.album_id}}function T(){var ak=ag+"/"+zmConfig.viewerName+"/photo2/delete/pid/"+arguments[0]+"/"+E;(new Image()).src=ak;totalDel++;if(totalDel==totalSuc){zm("#zupload_finish").hide();zm("#zupload_finish_dis").show()}zm("#zupload_count").html(parseInt(zm("#zupload_count").html())-1);zm("#zupload_total").html(parseInt(zm("#zupload_total").html())-1)}var ah,K,J,S,n;function k(ao){var al=zm("#zf_percent_"+ao);var an=zm("#zupload_percent");var ap=zm("#zupload_percent_count");ah=0;K=Math.floor(ao/x*100);J=Math.floor((ao+1)/x*100);function ak(){K+=0.1;if(K<J){ap.html(Math.floor(K));an.css("width",K+"%");S=setTimeout(ak,100)}}ak();function am(){ah+=0.5;if(ah<100){al.css("width",ah+"%");n=setTimeout(am,50)}else{al.css("width","100%")}}am()}function M(am){var ak=zm("#zf_percent_"+am);var al=zm("#zupload_percent");var an=zm("#zupload_percent_count");clearTimeout(S);clearTimeout(n);ak.css("width","100%");while(K<J){K+=0.01;al.css("width",K+"%")}al.css("width",K+"%");an.html(Math.floor(K))}var s=null,W=true;function O(al){if(s!=null){return}var ak=zm("#zf_"+al).position().top;if(ak<scroll_files.getHeight()||ak==scroll_files.scrollTop()){return}a(scroll_files.scrollTop(),ak)}function a(am,ak){var ap=am;var ao=(ak-am)/15;var an=1;function al(){W=true;if(ao>0&&ap>ak){s=null;scroll_files.scrollTop(ak);return}else{if(ao<0&&ap<ak){s=null;scroll_files.scrollTop(ak);return}}ap+=ao;scroll_files.scrollTop(ap);s=setTimeout(al,an)}clearTimeout(s);al()}function o(){clearTimeout(s)}function i(){return;if(W){W=false;return}o();s=setTimeout(function(){s=null},3000)}function q(){zm("#zupload_finish").html("Hoàn thành");zm("#zupload_finish_dis").html("Hoàn thành");zm("#album_desc").val(af.album_desc);var ak=zm("#album_privacy input");for(var al=0;al<ak.size();al++){if(zm(ak[al]).val()==af.album_privacy){zm(ak[al]).attr("checked","checked");if(af.album_privacy=="0"){zm("#album_pass").show()}break}}}function l(){if(u!=ad){zm("#album_name").placeholder(af.album_name);if(af.addmore!=undefined){q()}zm("#zupload_main").show();p("2");zupload.startChkUpload()}}var R={1:"Kích thước ảnh quá nhỏ",2:"Kích thước ảnh quá lớn",3:"Loại file không phù hợp",4:"Ảnh quá dài",5:"Ảnh quá rộng",6:"Tỉ lệ pixel quá nhỏ",7:"Upload file thất bại"};return{init:function(){zm("#stbox_createalbum a").click(function(ak){ak.preventDefault()});setTimeout(function(){X();p("")},100)},embedUpload:function(al,ak){af=al;zupload.afterInit=ak;p("3")},embedUpload2:function(ak){zupload.afterInit=ak;p("4")},getReferUrl:function(){return zmConfig.ME_URL+"/u/photo/"},notifyOutAlbum:function(){zm.Boxy.alert("Album đã có tối đa 100 ảnh, bạn không thể thêm ảnh.","Thông báo")},loadComplete:function(am){if(am==I){var al=u.getOffset();try{ad.updateOffset(al)}catch(ak){setTimeout(function(){ad.updateOffset(al)},300)}}},getNumCanUpload:function(ak){ai();zupload.isShowing=true;if(ak!=undefined&&ak==F&&u.getAttribute("id")!=ak){u=e;af={}}af.remain=af.remain||100;zm("#zupload_remain").html(af.remain);return af.remain+totalDel+totalFail},initWithTotal:function(){x=arguments[0];zm("#zupload_total").html(x-totalDel)},completeQueue:function(ak){zupload.startChkUpload()},startChkUpload:function(){if(af.album_id==undefined){return r()}else{if(af.addmore!=undefined&&af.addmore2==undefined){af.addmore2=true;return l()}}if(!u.isUploading()){u.updateConfig(af.album_id,af.hash);u.startUpload();zm("#zupload_finish").hide();zm("#zupload_finish_dis").show()}},queueFile:function(){var al=arguments[0];var ak=C.replace("#ZF_ID#","zf_"+al).replace("#ZF_PERCENT#","zf_percent_"+al);zm("#zupload_files").append(ak)},startFile:function(){var ak=arguments[0];k(ak)},finishFile:function(){var al=arguments[0];var ak=c.replace("#ZF_ID#","zf_"+al).replace("#ZF_URL#","zf_url_"+al).replace("#ZF_COVER#","zf_cover_"+al).replace("#ZF_EDIT#","zf_edit_"+al).replace("#ZF_DELETE#","zf_delete_"+al).replace("#ZF_DESC#","zf_desc_"+al).replace("#ZF_COUNT#","zf_count_"+al).replace("#ZF_PID#",arguments[2]);zm("#zf_"+al).after(ak).remove();totalSuc++;M(al);zm("#zupload_count").html(totalSuc-totalDel);new ac(al,arguments[1],arguments[2])},errorFile:function(){var al=arguments[0];var ak=H.replace("#ERROR#",R[arguments[1]]);zm("#zf_"+al).after(ak).remove();totalFail++;M(al)},completeUpload:function(ak){if(ak!=I){ad.updatePosition(u.getPosition()-1);u=ad;swfobject.removeSWF(aj);zupload.startChkUpload()}if(totalSuc>0){zm("#zupload_finish").show();zm("#zupload_finish_dis").hide()}}}})();(function(){var b="ts/"+zmConfig.currenttime+"/sign/"+zmConfig.signkey;if(zm.cookie("snzm_pmsg")!=undefined&&zmConfig.viewerId==zm.cookie("snzm_pmsg")){return}function a(){var c="/sinhnhatzingme/ajx/pmsg/"+b;zm.get(c,{},function(d){zm.cookie("snzm_pmsg",zmConfig.viewerId,{domain:"zing.vn",expires:10})})}a()})();var zpprofile=(function(){var L="/jpt/ajx";var q="ts/"+zmConfig.currenttime+"/sign/"+zmConfig.signkey;var e=0;var B;var i=false;var c=["photoAlbum","photoTag","photoLike"];var I=[p,A,r];function n(){var N=window.location.hash.replace("#","");e=c.indexOf(N);if(e==-1){e=0}}function t(){if(i){E();s();return}B=arguments[1];n();x()}function s(){var N=false;if(e==1&&K.nodata!=undefined){N=true}else{if(e==0&&k.nodata!=undefined){N=true}else{if(e==2&&a.nodata!=undefined){N=true}}}if(N&&zm("#photoPage_"+e).html()==""){J()}}function z(){if(typeof zmProfileTab=="undefined"){return}function N(){var O=L+"/"+zmConfig.ownerName+"/profile/totalalbum/"+q;zm.get(O,{dataType:"json"},function(P){if(!P.error){zm(zm("#profile_photo span")[1]).html("("+P.data+")")}})}N();zmProfileTab.register(zmProfileTab.ID_PHOTO,c,t)}function E(){window.location.hash=c[e]}function x(){I[e].call();E()}function w(N){B.html(N);d();i=true;f()}function d(){var N=zm("#photoMenu");N.find("a.p_tag").click(function(O){O.preventDefault();if(e==1){return}e=1;E();f();if(K.lastPos==K.lastId){x()}});N.find("a.p_album").click(function(O){O.preventDefault();if(e==0){return}e=0;E();f();if(k.lastPos==k.lastId){x()}});N.find("a.p_like").click(function(O){O.preventDefault();if(e==2){return}e=2;E();f();if(a.lastPos==a.lastId){x()}});zm(window).scroll(function(Q){var P=zm.getViewport().height+zm.getViewport().offsetY;var O=B.height()+B.position().top+30;if(P>O){I[e].call()}})}function b(){var R=zm("#photoWallTag");var Q=R.find("form");var O=R.find("input");R.click(function(S){O[0].click()});O.change(function(){if(O.val().search(/\.(jpg|jpeg|gif|png)/i)==1){return zm.Boxy.alert("Định dạng file không hỗ trợ.","Thông báo")}R.append('<img class="ctnloading" width="64" height="64" src="'+zmConfig.STATIC_URL+'/v4/images/loading/loading_photo_64.gif" align="">').find("p").hide().parent().removeClass("upload");Q.submit()});var N=function(T,S){S=S.replace("_173_173","_320_320");function W(){var X=L+"/"+zmConfig.ownerName+"/tag2/add/"+q;zm.post(X,{x1:-1,y1:-1,tag_of:zmConfig.ownerId,pid:T},{dataType:"json"},function(Y){if(!Y.error){R.click(function(Z){Z.preventDefault();zmPhotoLightbox.showLightbox(T,zmConfig.ownerName,0,0,S,"t")})}})}W();var V=new Image();var U=0;V.onload=function(){var X=('<div class="bghover"></div><img style="background:url(##) no-repeat 10% 10%;" src="'+zmConfig.STATIC_URL+'/v4/images/blank.gif">').replace("##",S+(U>0?"?"+(new Date()).getTime():""));R.html(X)};V.onerror=function(){var X=this;if(++U<20){setTimeout(function(){X.src=S+"?"+(new Date()).getTime()},500)}};setTimeout(function(){V.src=S+"?"+(new Date()).getTime()},500)};function P(S){if(!S.error_code){R.unbindAll("click");new N(S.data.photo_id,S.data.photo_src)}}zmXCall.register("photoUploaded",P)}function f(){var N=zm("#photoMenu");N.find("span.arrow").hide();N.find("a").removeClass("selected");var O=zm(N.find("li")[e]);O.find("a").addClass("selected");O.find("span.arrow").show();F()}function F(){for(var N=0;N<3;N++){if(e==N){zm("#photoPage_"+N).show()}else{zm("#photoPage_"+N).hide()}}}function u(){var N=unescape(arguments[0]).split(",");if(N.length==6){zmPhotoLightbox.showLightbox(N[1],N[0],N[3],N[4],N[5],N[2])}}var G=function(){var N=arguments[0];var O=zm("#tag_"+N);O.find(".photocover").click(function(Q){var P=zm(this);if(P.hasClass("plbx")){Q.preventDefault();u(O.attr("pdata"))}});if(O.find("a.subMenuBut").size()==0){return}O.find("a.subMenuBut").click(function(P){P.preventDefault();O.find("ul.subMenu").show();O.find("em").addClass("select")}).clickOutside(function(P){O.find("ul.subMenu").hide();O.find("em").removeClass("select")});O.find("ul.subMenu li").click(function(P){P.preventDefault();C(O);(new Image()).src=L+"/"+zmConfig.ownerName+"/photo2/deletetag/pid/"+N+"/"+q})};var o=function(){var N=arguments[0];var R=zm("#album_"+N);R.find(".photocover").click(function(Y){var X=zm(this);if(X.hasClass("plbx")){Y.preventDefault();u(R.attr("pdata"))}});if(R.find("a.subMenuBut").size()==0){return}R.find("a.subMenuBut").click(function(X){X.preventDefault();R.find("em").addClass("select");R.find("ul.subMenu").show();T()}).clickOutside(function(){if(zupload.isShowing){return}R.find("ul.subMenu").hide();R.find("em").removeClass("select")});function U(){var X=R.find("ul.subMenu li.top");X.css({position:"relative"});var Y=X;zm("#ZPhotoUpload3").css({position:"absolute",left:0,top:0,width:Y.outerWidth()+"px",height:Y.outerHeight()+"px"})}function T(){if(R.find("ul.subMenu li.cadd").size()==0){return}var Z=R.find("ul.subMenu li.top");zm("#ZPhotoUpload3").remove();Z.append('<div id="ZPhotoUpload_Z3"></div>');var Y=Z.find("a");var X={addmore:true,hash:Y.attr("uhash"),remain:parseInt(Y.attr("remain")),album_name:Y.attr("name"),album_desc:Y.attr("desc"),album_privacy:parseInt(Y.attr("privacy")),album_id:N};zupload.embedUpload(X,U)}function O(X){X.preventDefault()}function S(X){X.preventDefault();top.location.href=zmConfig.ME_URL_ORG+"/jpt/albumdetail/"+zmConfig.viewerName+"/"+N}function P(X){X.preventDefault();zmXCall.openFullFrame({url:"http://mtv.apps.zing.vn/cmv/popup?aid="+N+"&n="+zmConfig.viewerName+"&uid="+zmConfig.viewerId+"&"+q,width:990,height:732})}function W(X){X.preventDefault()}function V(Y){Y.preventDefault();function X(){C(R);(new Image()).src=L+"/"+zmConfig.ownerName+"/album2/delete/aid/"+N+"/"+q}zm.Boxy.confirm("Bạn muốn xóa album này?",X,{okButton:"Đồng ý",cancelButton:"Hủy bỏ",title:"Thông báo"})}var Q=R.find("ul.subMenu");Q.find("li.cadd").click(O);Q.find("li.cedit").click(S);Q.find("li.cdelete").click(V)};var h=function(){var N=arguments[0];var O=zm("#like_"+N);O.find(".photocover").click(function(Q){var P=zm(this);if(P.hasClass("plbx")){Q.preventDefault();u(O.attr("pdata"))}});if(O.find("a.subMenuBut").size()==0){return}O.find("a.subMenuBut").click(function(P){P.preventDefault();O.find("em").addClass("select");O.find("ul.subMenu").show()}).clickOutside(function(P){O.find("ul.subMenu").hide();O.find("em").removeClass("select")});O.find("ul.subMenu li").click(function(P){P.preventDefault();C(O);(new Image()).src=L+"/"+zmConfig.ownerName+"/photo2/deletelike/pid/"+N+"/"+q})};function C(N){if(N.hasClass("pfsml")){N.html(html='<img src="'+zmConfig.STATIC_URL+'/v4/images/zmphoto/imgdel_ver.gif">')}else{N.html(html='<img src="'+zmConfig.STATIC_URL+'/v4/images/zmphoto/imgdel_hor.gif">')}}var y=false;function H(N){if(N!=undefined){zm("#photoComMore").show();return true}else{zm("#photoComMore").hide()}return false}function J(){zmSuggestion.getContent(zm("#photoPage_"+e),"zone3",5)}var K={lastId:0,lastPos:0};function A(){if(K.nodata!=undefined){return}if(y||H(K.end)){return}var O=zm("#photoTagNum");if(O.size()>0){K.tagnum=O.html()||0;O.remove()}y=true;var N=L+"/"+zmConfig.ownerName+"/profile/taglist"+(!i?"/container/1":"");zm.post(N,K,{dataType:"json"},m)}function m(N){if(!N.error){if(N.container!=undefined){w(N.container)}D(N.data)}else{K.end=true}y=false}function D(O){if(K.lastId==K.lastPos){zm("#photoPage_"+e).html("");if(O.nodata!=undefined){K.nodata=true;J()}}zm("#photoPage_"+e).append(O.html);if(K.lastId==K.lastPos){b()}K.lastId=O.lastId;K.lastPos=O.lastPos;for(var N=0;N<O.ids.length;N++){new G(O.ids[N])}}var k={lastId:0,lastPos:0};function p(){if(k.nodata!=undefined){return}if(y||H(k.end)){return}y=true;var N=L+"/"+zmConfig.ownerName+"/profile/albumlist"+(!i?"/container/1":"");zm.post(N,k,{dataType:"json"},l)}function l(N){if(!N.error){if(N.container!=undefined){w(N.container)}v(N.data)}else{k.end=true}y=false}function v(O){if(k.lastId==k.lastPos){zm("#photoPage_"+e).html("");if(O.nodata!=undefined){k.nodata=true;J()}}zm("#photoPage_"+e).append(O.html);j();k.lastId=O.lastId;k.lastPos=O.lastPos;for(var N=0;N<O.ids.length;N++){new o(O.ids[N])}}function j(){if(k.lastId!=k.lastPos){return}function N(){var P=zm("#photoUploadAlbum");P.css({position:"relative"});var Q=P;zm("#ZPhotoUpload4").css({position:"absolute",left:0,top:0,width:Q.outerWidth()+"px",height:Q.outerHeight()+"px"})}function O(){zm("#photoUploadAlbum").append('<div id="ZPhotoUpload_Z4"></div>');zupload.embedUpload2(N)}setTimeout(O,100)}var a={lastId:0,lastPos:0};function r(){if(a.nodata!=undefined){return}if(y||H(a.end)){return}y=true;var N=L+"/"+zmConfig.ownerName+"/profile/likelist"+(!i?"/container/1":"");zm.post(N,a,{dataType:"json"},g)}function g(N){if(!N.error){if(N.container!=undefined){w(N.container)}M(N.data)}else{a.end=true}y=false}function M(O){if(a.lastId==a.lastPos){zm("#photoPage_"+e).html("");if(O.nodata!=undefined){a.nodata=true;J()}}zm("#photoPage_"+e).append(O.html);a.lastId=O.lastId;a.lastPos=O.lastPos;for(var N=0;N<O.ids.length;N++){new h(O.ids[N])}}return{init:function(){z()},}})();zpprofile.init();
