var zmPW=(function(){var B=500,v=500,y=200,j=6,s=["","icostar","icofan","icocom"];var u=zmConfig.MINIPROFILE_URL+"/api/minip?method=getMini&viewer=",k=zmConfig.BASE_URL+"lcinfo/info",x=zmConfig.APPSOTRE_MINIPROFILE_URL+"/wg/profile";var c,t={},d,D,G,l={},C=[],i=[],H;zm.ready(function(){c=new zm.CalloutPopup({scrollable:false,popupClass:"frdactivities miniprofile"});zm(c.getElement()).hover(function(){setTimeout(function(){zmPW.leaveTimeout&&clearTimeout(zmPW.leaveTimeout)},10)},function(){if(zmPW.hoveredElement){zmPW.leaveTimeout=setTimeout(function(){!H&&o()},y)}delete zmPW.hoveredElement}).mouseup(function(J){J.stopPropagation()}).find(".contdisbox").click(function(){var J=zm(this);if(J.hasClass("poke")){return m()}else{if(J.hasClass("sendmsg")){return A()}else{if(J.hasClass("makefr")){return z()}else{if(J.hasClass("posttowall")){return n()}else{if(J.hasClass("like")){return p()}else{if(J.hasClass("fan")){return e()}}}}}}});zm(window).scroll(function(){H=false;zmPW.hm()});var I=new Image();I.src=zmConfig.IMAGE_URL+"/loading/loading_32.gif"});function a(){if(D&&window.zmGift){zmGift.send(D,null,"mini");zmPW.hideMiniProfile()}return false}function m(){if(d&&window.zmCommon){zmCommon.pokeFriend(d);zmPW.hideMiniProfile()}return false}function A(){if(d&&window.zmPrivateMessage){zmPrivateMessage.send(d,t[d]&&t[d].displayName);zmPW.hideMiniProfile()}return false}function z(){if(D&&window.zmFriendRequests){zmFriendRequests.sendRequest(D,null,{check_avatar:1,source:117});zmPW.hideMiniProfile()}return false}function e(){d&&D&&window.zmCommon&&zmCommon.subscribe("/act/"+d+"/lightbox/subcribe?key="+G,1,D,q);return false}function p(){d&&D&&window.zmCommon&&zmCommon.subscribe("/act/"+d+"/lightbox/subcribe?key="+G,2,D,q);return false}function q(J){if(J.status=="success"){if(d&&t[d]){t[d].isfan=true}var I=zm("#mpsubsbtn");I.parent().html('<span class="zmsprt zmico icochecknote"></span>'+I.text())}else{if(J.type=="alert"){zm.Boxy.alert(J.content,"Thông báo",3000)}}}function n(){var I=zm("#mpptwtxt"),J=zm.trim(I.val());if(!J){I.focus()}else{if(d&&window.zmStatus&&J){zmStatus.pushFeed("",J,{to:d,fromtracking:"mp",pointElement:c.getElement(),success:o})}}return false}function E(I){if(I=="chat"){return"disbox_chat"}else{if(I=="as"){return"apptipbox"}}return"disbox_minipro"}function F(I){if(!I||!zm.isString(I)){return null}var J=I.split("-");if(!J||J.length<3){return null}return{day:J[2],month:J[1],year:J[0]}}function r(J){var I="";if(J){if(J.lastUpdate>0){I+=zmDateTime.format(J.lastUpdate/1000)+'<span class="icodot"></span>'}I+=J.totalComment+' bình luận<span class="icodot"></span><span class="likelink">'+J.totalLike+" thích</span"}return I}function g(M,T,J,K){var R,N,U,L,S;var P=M.uid,Q=M.type,I="zmp_"+P+Math.floor(Math.random()*1000),O=T=="chat"?100:50;if(M.isCert&&M.certAvaPath){R='<div class="avtuser"><a href="'+zmConfig.PROFILE_URL+"/"+M.uname+'" target="_blank"><img src="'+M.certAvaPath+'" alt=""></a></div>'}else{R='<div class="avtuser"><span id="'+I+'" style="width: '+O+"px;height: "+O+'px;display: inline-block;"></span></div>';zwg.addItem(I,"ZMEA_"+P+"?id=1&l=2&size=120&width="+O+"&height="+O)}N='<a href="'+zmConfig.PROFILE_URL+"/"+M.uname+'" target="_blank">'+zm.trim(M.displayName)+"</a>";if(Q!=0){N+='<span class="feed_sprt feed_ico16 '+s[Q]+'"></span>'}U='<img width="400" src="'+M.cover+'" alt="" />';L='<div class="minipfbtn">';if(Q==0){L+='<div class="minipfbtn_lt showlevel">'+(M.tfr>0?'<p class="prfmutualfrd">'+M.tfr+" bạn</p>":'<p class="prfmutualfrd" style="display:inline-block;width:1px;height:25px;"></p>')+'<div class="user_level"><span class="lvgrp'+(parseInt(M.lv/5)+1)+' icolevel"><em class="lvnum'+M.lv+' lvnumtxt"></em></span></div></div>'+(P==zmConfig.viewerId?"":'<div class="minipfbtn_rt">'+(M.isf?'<a href="#" class="zmbtn02 sendmsg">Nhắn tin</a><a href="#" class="zmbtn02 poke">Chọc ghẹo</a>':'<a href="#" class="zmbtn02 makefr">Kết bạn</a>')+"</div>")}else{L+=(M.tf>0?'<p class="minipfbtn_lt">'+zmString.formatNumber(M.tf)+" người "+(Q==1?"hâm mộ":"thích")+"</p>":'<p class="minipfbtn_lt" style="visibility:hidden">&nbsp;</p>')+(P==zmConfig.viewerId?"":'<p class="minipfbtn_rt">'+(M.isfan?'<span class="zmsprt zmico icochecknote"></span>':'<a id="mpsubsbtn" href="#" class="zmbtn02'+(Q==1?" fan":" like")+'">')+(Q==1?"Hâm mộ":"Thích")+(M.isfan?"":"</a>")+"</p>")}L+="</div>";if(zmConfig.viewerId>0&&P!=zmConfig.viewerId&&M.isf&&M.wall!=0){S='<div class="minipfbottom">				<div class="bxwritestt"><textarea id="mpptwtxt" placeholder="Viết gì đó cho '+M.displayName+'..." cols="" rows="" class="bxcmt"></textarea></div>				<p class="fr"><a class="zmbtn01 posttowall disable" href="#">Gửi</a></p>			</div>'}else{S=""}return'<div class="minipftop">					<div class="minipfcover">'+R+'<div class="bgusername">'+N+"</div>"+U+"</div>"+L+"</div>"+S+'<div class="clr"></div>'}function w(J){var S=J.appId,M=J.detailLink,Q=J.point,P=J.title,K=J.imgLink,R=J.cateLink,O=J.playLink,I=J.cateName,N=110,L='<div class="contdisbox">					<div class="inner">						<p class="app_thumb">							<span style="background-image: url(\''+K+'\');" class="rapp_thumb">								<a href="'+M+'" title="'+P+'">									<img width="'+N+'" height="'+N+'" src="'+K+'" alt="'+P+'">								</a>							</span>						</p>						<ul class="app_desctext">							<li class="apptipboxname">'+P+'</li>							<li><span class="appstorestar appstar_'+Q+'"></span></li>							<li><strong>Thể loại:</strong> <a title="'+I+'" href="'+R+'">'+I+'</a></li>							<li class="apptitbox_bot">								<a title="Tham Gia" href="'+O+'" class="btn_L10 app_btnplaynow">									<strong>Tham Gia</strong>								</a>								<a title="Xem chi tiết" href="'+M+'" class="detailapp_link" id="wg_'+S+'">Xem chi tiết</a>							</li>						</ul>						<div class="clr"></div>					</div>				</div>';return L}function b(L,M,O,I){H=false;if(O=="as"){c.setContent(w(M,O,L))}else{c.setContent(g(M,O,L,I))}I=0;if(I>0){var K={viewerId:zmConfig.viewerId,feedId:I},N=function(Q){if(Q.errorCode!=0){return}var P=zm("#mpstt_"+I);if(P.size()>0){P.prepend(r(Q.data))}else{l[I]=Q}};if(location.host=="me.zing.vn"){zm.post(k,K,{dataType:"json"},N)}else{zm.getJSON(zmConfig.ME_URL+k+"?"+zm.param(K),N)}}var J=new Image();J.onload=function(){if(zmPW.hoveredElement!=L||zm(L).is(":hidden")){o();return}c.show(zm(L),{beforeShow:function(){zwg.fillWg();d=M.uname;D=M.uid;G=M.k},afterShow:function(){zm("#mpptwtxt").keypress(function(R){if(!R.shiftKey&&R.keyCode==13){return n()}}).keydown(function(R){if(R.keyCode==27){this.value=""}}).keyup(function(){H=!!this.value;zm(this).parents(".contdisbox").find(".posttowall")[this.value?"removeClass":"addClass"]("disable")}).focus(function(){H=true}).blur(function(){H=!!this.value});for(var Q=0,P;P=C[Q];Q++){P(d,D)}},valign:O!="chat"})};J.src=M.cover}function o(){c.hide();for(var J=0,I;I=i[J];J++){I(d,D)}d=null;D=null}function h(K,J,L){var I;switch(J){case 1:I="Tài khoản này không tồn tại.";break;default:I="Có lỗi xảy ra! Vui lòng thử lại sau.";break}c.setContent('<p align="center" style="padding: 5px; min-width: 250px">'+I+"</p>");c.show(K,{valign:L!="chat"})}function f(I,J){H=false;c.setContent('<p align="center" style="padding: 6px; width: 250px"><img src="'+zmConfig.IMAGE_URL+'/loading/loading_32.gif" alt="" /></p>');c.show(I,{valign:J!="chat"})}return{mixHover:function(J,L,I){var K;if(zm.isString(J)&&!I){J="#"+J}if(J instanceof zmCore){K=J}else{K=zm(J)}K.each(function(){if(!zm.data(this,"miniprofile")){var N=zm(this),M=N.attr("href");zm.isString(M)&&M.indexOf("/u/")>=0&&N.hover(function(){zmPW.sm(this)},function(){zmPW.hm()});zm.data(this,"miniprofile",true)}})},showMiniProfile:function(M,J,L,I){M=zm.trim(M);if(!M||!J){return}zmPW.hoveredElement=J;var K=t[M];if(K){b(J,K,L,I)}else{setTimeout(function(){if(!zmPW.hoverTimeout){return}f(J,L);var N="&fields=cover";zm.getJSON(u+zmConfig.viewerName+"&uname="+M+N,function(Q){var P=Q==undefined?3:Q.err,O=J==zmPW.hoveredElement;if(P!=0){O&&h(J,P,L)}else{t[M]=Q.data;O&&b(J,Q.data,L,I)}})},v)}},hideMiniProfile:function(){if(H){return}if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout);delete zmPW.hoverTimeout}if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}o()},showMiniAppsProfile:function(L,J,N,M,I){if(!L||!J){return}zmPW.hoveredElement=J;var K=t[L];if(K){b(J,K,N,0,I)}else{setTimeout(function(){if(!zmPW.hoverTimeout){return}zm("#mppopup").attr("class",E(N));zm("#mppopuptemp").attr("class",E(N));var O;if(M){O="&_src="+M}f(J,N);zm.getJSON(x+"?appId="+L+O,function(R){var Q=R==undefined?3:R.err,P=J==zmPW.hoveredElement;if(Q!=0){P&&h(J,Q,N)}else{t[L]=R;P&&b(J,R,N,0,I)}})},v)}},sm:function(J,L,K,I){if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout)}zmPW.hoverTimeout=setTimeout(function(){var M=/\/u\/([a-z0-9\.\-_]+)\/?.*/i.exec(zm(J).attr("href"));zmPW.showMiniProfile((M&&M[1])||L,J,K,I)},B)},am:function(K,L,N,I,M,J){if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout)}zmPW.hoverTimeout=setTimeout(function(){zmPW.showMiniAppsProfile(L,K,N,I,J)},B)},hm:function(){if(H){return}if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout);delete zmPW.hoverTimeout}zmPW.leaveTimeout=setTimeout(o,y)},showSimple:function(I){if(zmPW.leaveTimeout){clearTimeout(zmPW.leaveTimeout)}if(zmPW.hoverTimeout){clearTimeout(zmPW.hoverTimeout)}zmPW.hoverTimeout=setTimeout(function(){var J=/\/u\/([a-z0-9\.\-_]+)\/?.*/i.exec(zm(I).attr("href"));zmPW.showMiniProfile((J&&J[1]),I,null,"nofooter")},B)},onShow:function(I){if(zm.isFunction(I)&&zm.inArray(I,C)==-1){C.push(I)}},onHide:function(I){if(zm.isFunction(I)&&zm.inArray(I,i)==-1){i.push(I)}}}})();
