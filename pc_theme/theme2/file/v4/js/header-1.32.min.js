(function(M){var o={},j=false,L={nt:-1,fr:-1,pm:-1,gn:-1},X={nt:0,fr:0,pm:0,gn:0},P=-1,A=0,x=document.title,t=zmConfig.ME_URL,s='<div id="zmntdetail" class="zmnotifddlist" onmouseover="this.parentNode.title=\'\';" onmouseout="this.parentNode.title=\'Thông báo\'">			<span class="zmnotifddl_arrow"><span></span></span>			<div class="zmnotifddl_border">				<div class="zmnotifddl_top"><strong>BẠN CÓ GÌ MỚI</strong></div>				<div class="zmnotifddl_inner">					<div class="notifbox_cont ntlist" id="ntlist">					</div>				</div>				<div class="zmnotifddl_bottom">					<!--p class="zmbotnotif_left">						<a class="zmnotif_setting" href="'+t+"/pi/"+zmConfig.viewerName+'?t=noti#noti" target="_blank">							<span class="notifsetting_icn"></span>Cài đặt thông báo						</a>					</p-->					<p class="zmbotnotif_right">						<a class="zmnotif_viewall" target="_blank" href="'+t+'/apps/notify?fromid=0&count=30&type=3&masterpage=3">Xem tất cả</a>					</p>				</div>			</div>		</div>',z='<div class="zmgamenotif zmnttab" id="zmgnicon" title="Thông báo từ game">                                <span class="zmgamenotif_icn zmnticon"></span>                                <span id="zmgncounter" class="zmntcounter" style="display: none;"></span>                            </div>',v='<div id="zmgndetail" class="zmnotifddlist">			<span class="zmnotifddl_arrow"><span></span></span>			<div class="zmnotifddl_border">				<div class="zmnotifddl_top"><strong>THÔNG BÁO TỪ GAME</strong></div>				<div class="zmnotifddl_inner">					<div class="notifbox_cont gnlist" id="gnlist">					</div>				</div>				<div class="zmnotifddl_bottom">					<p class="zmbotnotif_right">						<a class="zmnotif_viewall" target="_blank" href="'+t+'/apps/notify?fromid=0&count=30&type=10&masterpage=3">Xem tất cả</a>					</p>				</div>			</div>		</div>',l='<div id="popup-notification"><div class="zme_notify loadingrow"></div></div>				<div id="popup-morenotification" style="text-align: center; background-color: #F0F3F7;"></div>',e='<div id="popup-gamenotification"><div class="zme_notify loadingrow"></div></div>				<div id="popup-moregamenotification" style="text-align: center; background-color: #F0F3F7;"></div>',R='<div id="popup-pmnotification"><div class="zme_notify loadingrow"></div></div>				<div id="popup-morepmnotification" style="text-align: center; background-color: #F0F3F7;"></div>',q='<div id="zmpmdetail" class="zmnotifddlist">                            <span class="zmnotifddl_arrow"><span></span></span>                            <div class="zmnotifddl_border">                                    <div class="zmnotifddl_top">                                            <p class="rhtext"><a href="'+t+'/jpm/new" target="_blank">Gửi tin nhắn mới</a></p>                                            <strong>TIN NHẮN</strong>                                    </div>                                    <div class="zmnotifddl_inner">					<div class="notifbox_cont pmlist" id="pmlist">					</div>                                    </div>                                    <div class="zmnotifddl_bottom">                                            <!--<p class="zmbotnotif_left">                                                    <a class="zmnotif_setting" href="'+t+"/pi/"+zmConfig.viewerName+'#noti" target="_blank">                                                            <span class="notifsetting_icn"></span>Cài đặt tin nhắn                                                    </a>                                            </p>-->                                            <p class="zmbotnotif_right">                                                    <a class="zmnotif_viewall" target="_blank" href="'+t+'/jpm">Xem tất cả</a>                                            </p>                                    </div>                            </div>                    </div>',S='<div id="zmfrdetail" class="zmnotifddlist">					<span class="zmnotifddl_arrow"><span></span></span>					<div class="zmnotifddl_border">						<div class="zmnotifddl_top">							<p class="rhtext"><a href="'+t+'/jfr/pr/friendinvite" target="_blank">Tìm thêm bạn mới</a></p>							<strong>LỜI MỜI KẾT BẠN (<span id="zmfr_num"></span>)</strong>						</div>						<div class="zmnotifddl_inner">							<div class="notifbox_cont frdlist" id="frlist"><div class="zme_notify loadingrow"></div></div>						</div>						<div class="zmnotifddl_bottom">							<p class="zmbotnotif_left">								<a class="zmnotif_setting" href="'+t+"/u/"+zmConfig.viewerName+'#prof_info_sp" target="_blank">									<span class="notifsetting_icn"></span>Cài đặt								</a>							</p>							<p class="zmbotnotif_right">								<a class="zmnotif_viewall" target="_blank" href="'+t+"/u/"+zmConfig.viewerName+'#friendrequest">Xem tất cả</a>							</p>						</div>					</div>				</div>',T=new zm.Template('<div id="freq_{3}" class="zme_notify">					<div class="zmntfrdactbtn">						<a class="frdrejectbtn" title="Từ chối" href="#reject" onclick="zmFriendRequests.rejectRequest({3},function(){zmNotifications.removeFrRequest({3});});return false;"><span class="frdreject_ico zmico"></span></a>						<a class="frdacceptbtn" title="Đồng ý" href="#accept" onclick="zmFriendRequests.acceptRequest({3},function(){zmNotifications.removeFrRequest({3});});return false;" ><span class="frdaccept_ico zmico"></span><strong>Đồng ý</strong></a>					</div>					<span id="fr_avatar_{0}" class="notifyavt"></span>					<div class="zmnrcontent">						<a href="{4}"><strong id="fr_sendername_{0}" class="zmnr_username"></strong></a>						<p class="notif_invite_msg">{1}</p>						<span class="notiftimelabel">{2}</span>					</div>				</div>');function i(Y){switch(Y){case"&":return"&amp;";case">":return"&gt;";case"<":return"&lt;";case'"':return"&quot;";case"\n":return"<br>"}return Y}function N(ac,ad,ae,af,ag,Y,Z,ab){var aa;if(ab>0){aa=(ab>=100?"100+":ab)}else{aa=0}Y=Y.replace(/[><\"\n]/g,i);Y=Y.replace(/&(?!gt;|lt;|quot;)/g,"&amp;");return'<a class="zme_notify pmnotify'+(ab>0?" unread":"")+'" '+(ac!=null?'data-uid="'+ac+'" onclick="zmChat.chatWith('+ac+', true); return false;"':"")+' data-cid="'+ad+'" href="'+zmConfig.ME_URL+"/jpm/"+ae+'" target="_blank">                    <span class="notifyavt"><img src="'+af+'" alt="'+ag+'" /></span>                    <span class="zmnrcontent">                            <span class="unreadmsg_number" '+(ab>0?"":'style="display:none;"')+">"+aa+'</span>                            <strong class="zmnr_username" title="'+ag+'">'+ag+'</strong>                            <p class="pmtxt" title="'+Y+'">'+Y+'</p>                            <span class="notiftimelabel">'+Z+"</span>                    </div>                </div>"}function n(){A=1-A;if(A==0){document.title="Bạn có tin nhắn mới - "+x}else{document.title=x}}function w(){if(P!=-1){clearInterval(P)}A=0;P=setInterval(n,3000)}function m(){clearInterval(P);P=-1;document.title=x}function G(ab){for(var aa in ab){var Z=parseInt(ab[aa]),Y=zm("#zm"+aa+"counter");if(!Z||Z==-1){Y.hide();if(P!=-1){m()}}else{if(aa=="pm"){Z=Z>=20?"20+":Z}else{Z=Z>=100?"100+":Z}Y.html(Z.toString());Y.show();if(P==-1&&aa!="fr"){w()}}L[aa]=Z}}function k(){var Y=zmNotifications.config;if(!Y){return}for(var Z=0;Z<Y.servers.length;Z++){var ab=Y.servers[Z];if(!zm.isString(ab)){continue}if(ab.indexOf("|")>=0){zm.log("[ZMNotf] Config error syntax.");continue}var aa=zm.createElement("iframe",{},{visibility:"hidden",position:"absolute",top:"0",left:"0",width:"0",height:"0"});try{aa.src="http://"+ab+"/subframe-"+Y.frameVersion+".html#"+Y.channel+"_"+Y.sign+"_"+Y.zmVersion;document.body.appendChild(aa)}catch(aa){}}zm(M).bind("message",function(af){var ah=af.origin,ag=zmNotifications.config.servers,ac=false;for(var ad=0,ae;ae=ag[ad];ad++){if(ah.indexOf(ae)>-1){ac=true;break}}ac&&zmEvent.fire("notify.all",zm.parseJSON(af.data))})}function d(){var Z="/ntft/counter",aa={viewerId:zmConfig.viewerId,signkey:zmConfig.signkey,time:zmConfig.time,type:2,cates:"nt,fr,gn"},ac=function(ae){G(ae)};var Y="/jpm/ajax",ab={action:"unread",type:"gettotal"},ad=function(ae){G({pm:ae.total})};if(location.host=="me.zing.vn"){zm.post(Z,aa,{dataType:"json"},ac);zm.get(Y,ab,{dataType:"json"},ad)}else{zm.getJSON(zmConfig.ME_URL+Z+"?"+zm.param(aa),ac);zm.getJSON(zmConfig.ME_URL+Y+"?"+zm.param(ab),ad)}}function f(ab,Y,Z,aa){zm("#zm"+ab+"icon").bind("click",function(){if(zm(this).parents("#zm"+ab+"detail").size()>0){return}zm("#zm"+ab+"counter").hide();if(L.pm>0){zmCommon.makeRequest("/jpm/ajax","POST",{action:"unread",type:"cleartotal"},function(ad){if(ad.msg=="Successfully"){G({pm:0})}})}var ac=zm("#zm"+ab+"detail");if(ac.length){if(X[ab]=1-X[ab]){ac.show()}else{ac.hide();return}}else{zm("#zm"+ab+"icon").append(Y);X[ab]=1;if(aa){aa()}}Z()}).clickOutside(function(){zm("#zm"+ab+"detail").hide();X[ab]=0},0,false,"zmcog.notifications"+ab)}function V(){if(zm("#popup-notification").html()!='<div class="zme_notify loadingrow"></div>'&&L.nt==0){if(zm("#ntlist .zmscrollableui").height()==0){zm("#ntlist .zmscrollableui").css("height","438px")}return}zm("#popup-notification").html('<div class="zme_notify loadingrow"></div>');zm.getJSON(zmConfig.ME_URL+"/ntft/zme",{viewerId:zmConfig.viewerId,signkey:zmConfig.signkey,time:zmConfig.time,cate:"nt",fromid:0,count:15,type:1},function(Y){if(Y.errorCode==0){m();zm("#popup-notification").html(Y.data);zm("#popup-notification").attr("view-more",Y.more).attr("last-id",Y.lastId);if(zm("#popup-notification .zme_notify").size()<7){K(null,null,1)}L.nt=0;zmfw.scanNtf();u();zm("#zmntdetail .zmnotif_viewall").show()}else{zm("#popup-notification").html('<div class="zme_notify emptyrow">Bạn không có thông báo nào.</div>');zm("#zmntdetail .zmnotif_viewall").hide()}})}function y(){if(zm("#popup-gamenotification").html()!='<div class="zme_notify loadingrow"></div>'&&L.gn==0){if(zm("#gnlist .zmscrollableui").height()==0){zm("#gnlist .zmscrollableui").css("height","438px")}return}zm("#popup-gamenotification").html('<div class="zme_notify loadingrow"></div>');zm.getJSON(zmConfig.ME_URL+"/ntft/game",{viewerId:zmConfig.viewerId,signkey:zmConfig.signkey,time:zmConfig.time,cate:"gn",fromid:0,count:15,type:10},function(Y){if(Y.errorCode==0){m();zm("#popup-gamenotification").html(Y.data);zm("#popup-gamenotification").attr("view-more",Y.more).attr("last-id",Y.lastId);if(zm("#popup-gamenotification .zme_notify").size()<7){a(null,null,1)}L.gn=0;zmfw.scanNtf();u();zm("#zmgndetail .zmnotif_viewall").show()}else{zm("#popup-gamenotification").html('<div class="zme_notify emptyrow">Bạn không có thông báo nào.</div>');zm("#zmgndetail .zmnotif_viewall").hide()}})}function W(){if(zm("#popup-pmnotification").html()!='<div class="zme_notify loadingrow"></div>'&&j){if(zm("#pmlist .zmscrollableui").height()==0){zm("#pmlist .zmscrollableui").css("height","438px")}return}zm("#popup-pmnotification").html('<div class="zme_notify loadingrow"></div>');zm.getJSON(zmConfig.ME_URL+"/jpm/ajax",{action:"pmnotify"},function(ac){if(ac.msg=="Successfully"){var ab=ac.data.list.length,aa,ad,Y;if(ab>0){m();zm("#popup-pmnotification").html("");for(var Z=0;Z<ab;Z++){aa=ac.data.list[Z];ad=aa.lastestMsg.replace(new RegExp("^(#[a-f0-9]{1,6})\\s+","g"),"");if(aa.unread){Y=aa.unread}else{Y=0}o[aa.cid]=Y;zm("#popup-pmnotification").append(N((aa.userid?aa.userid:null),aa.cid,(aa.username?"u/"+aa.username:"conversation?id="+aa.cid),aa.avatar,aa.fullname,ad,zm.formatDateTime(aa.time),Y))}zm("#popup-pmnotification").attr("view-more",ac.data.more).attr("last-id",ac.data.lastId);if(zm("#popup-pmnotification .zme_notify").size()<6){h(null,null,1)}zm("#zmpmdetail .zmnotif_viewall").show();j=true}else{zm("#popup-pmnotification").html('<div class="zme_notify emptyrow">Bạn không có tin nhắn nào.</div>');zm("#zmpmdetail .zmnotif_viewall").hide()}}else{zm("#popup-pmnotification").html('<div class="zme_notify emptyrow">Bạn không có tin nhắn nào.</div>');zm("#zmpmdetail .zmnotif_viewall").hide()}})}function g(){zm("#zmfr_num").html(0);zm("#frlist").html('<div class="zme_notify emptyrow">Bạn không có lời mời nào.</div>');zm("#zmfrdetail .zmnotif_viewall").hide()}function H(Y){if(zm("#frlist").html()!='<div class="zme_notify loadingrow"></div>'&&L.fr==0&&!Y){return}zm.getJSON("http://me.zing.vn/jfr/widget/topreq",function(ab){L.fr==0;if(ab.total){m();zm("#zmfr_num").html(ab.total);var ad=[],Z=ab.list.length>6?6:ab.list.length;for(var aa=0;aa<Z;aa++){var ac=ab.list[aa];ad.push(T.render(aa,ac.content?ac.content.replace("<","&lt;"):"",ac.time!=0?zm.formatDateTime(ac.time):"",ac.id));zwg.addItem("fr_avatar_"+aa,"ZMEA_"+ac.id+"?id=1&l=1&size=42&width=42&height=42");zwg.addItem("fr_sendername_"+aa,"ZMED_"+ac.id+"?id=1&l=1")}zm("#frlist").html(ad.join(""));zm("#zmfrdetail .zmnotif_viewall").show();zwg.fillWg()}else{g()}})}function U(){if(zm("#zmgnicon").length==0){zm("#zmnticon").before(z)}f("nt",s,V,function(){zm("#ntlist").append(new zm.ScrollableUI({content:l,width:356,uiClass:"notification",maxHeight:438,onscroll:K}).getElement())});f("gn",v,y,function(){zm("#gnlist").append(new zm.ScrollableUI({content:e,width:356,uiClass:"notification",maxHeight:438,onscroll:a}).getElement())});f("pm",q,W,function(){zm("#pmlist").append(new zm.ScrollableUI({content:R,width:356,uiClass:"notification",maxHeight:438,onscroll:h}).getElement())});f("fr",S,H);d();zm("#perheaderid").click(function(){zm("#perheaderid")[zm("#sub").toggle().is(":hidden")?"removeClass":"addClass"]("selected");return false}).clickOutside(function(){zm("#sub").hide();zm("#perheaderid").removeClass("selected")}).clickOutsideWith(zm("#sub"));p();r()}function J(){}function K(Y,aa,Z){if(Z==1&&zm("#popup-notification").attr("view-more")==="1"){if(zm("#popup-notification").find(".loadingrow").length==0){zm("#popup-notification").append('<div class="zme_notify loadingrow">')}zm.getJSON(zmConfig.ME_URL+"/ntft/zme",{viewerId:zmConfig.viewerId,signkey:zmConfig.signkey,time:zmConfig.time,cate:"nt",fromid:zm("#popup-notification").attr("last-id"),count:15,type:1},function(ab){zm("#popup-notification").find(".loadingrow").remove();if(ab.errorCode==0){if(parseInt(zm("#popup-notification").attr("last-id"))>parseInt(ab.lastId)){zm("#popup-notification").append(ab.data).attr("view-more",ab.more).attr("last-id",ab.lastId);if(zm("#popup-notification .zme_notify").size()<7){K(null,null,1)}}L.nt=0;zmfw.scanNtf();u();zm("#zmntdetail .zmnotif_viewall").show()}})}}function a(Y,aa,Z){if(Z==1&&zm("#popup-gamenotification").attr("view-more")==="1"){if(zm("#popup-gamenotification").find(".loadingrow").length==0){zm("#popup-gamenotification").append('<div class="zme_notify loadingrow">')}zm.getJSON(zmConfig.ME_URL+"/ntft/game",{viewerId:zmConfig.viewerId,signkey:zmConfig.signkey,time:zmConfig.time,cate:"gn",fromid:zm("#popup-gamenotification").attr("last-id"),count:15,type:10},function(ab){zm("#popup-gamenotification").find(".loadingrow").remove();if(ab.errorCode==0){if(parseInt(zm("#popup-gamenotification").attr("last-id"))>parseInt(ab.lastId)){zm("#popup-gamenotification").append(ab.data).attr("view-more",ab.more).attr("last-id",ab.lastId);if(zm("#popup-gamenotification .zme_notify").size()<7){a(null,null,1)}}L.gn=0;zmfw.scanNtf();u();zm("#zmgndetail .zmnotif_viewall").show()}})}}function h(Y,aa,Z){if(Z==1&&zm("#popup-pmnotification").attr("view-more")==="1"){zm("#popup-pmnotification").attr("view-more",0);if(zm("#popup-pmnotification").find(".loadingrow").length==0){zm("#popup-pmnotification").append('<div class="zme_notify loadingrow">')}zm.getJSON(zmConfig.ME_URL+"/jpm/ajax",{action:"pmnotify",fromid:zm("#popup-pmnotification").attr("last-id")},function(af){if(af.msg=="Successfully"){zm("#popup-pmnotification").find(".loadingrow").remove();var ae=af.data.list.length,ad,ag,ab;if(ae>0){if(parseInt(zm("#popup-pmnotification").attr("last-id"))<parseInt(af.data.lastId)){for(var ac=0;ac<ae;ac++){ad=af.data.list[ac];ag=ad.lastestMsg.replace(new RegExp("^(#[a-f0-9]{1,6})\\s+","g"),"");if(ad.unread){ab=ad.unread}else{ab=0}o[ad.cid]=ab;zm("#popup-pmnotification").append(N((ad.userid?ad.userid:null),ad.cid,(ad.username?"u/"+ad.username:"conversation?id="+ad.cid),ad.avatar,ad.fullname,ag,zm.formatDateTime(ad.time),ab))}zm("#popup-pmnotification").attr("view-more",af.data.more).attr("last-id",af.data.lastId);if(zm("#popup-pmnotification .zme_notify").size()<6){h(null,null,1)}}zm("#zmpmdetail .zmnotif_viewall").show();c()}}else{zm("#popup-pmnotification").find(".loadingrow").remove()}})}}function c(){var Y=zm("#popup-pmnotification .pmnotify"),Z={};zm.each(Y,function(){var aa=zm(this).attr("data-cid");if(Z[aa]){zm(this).remove()}else{Z[aa]=true}})}function F(ae){var ac=zm("#popup-pmnotification"),Z;var ab=ae.data.msg.replace(new RegExp("^(#[a-f0-9]{1,6})\\s+","g"),""),ad=zm.formatDateTime(ae.data.ts);Z=ac.find(".pmnotify[data-cid='"+ae.data.cid+"']");if(Z.length>0){Z.find(".pmtxt").attr("title",ab).text(ab);Z.find(".notiftimelabel").text(ad);if(o[ae.data.cid]>0){Z.addClass("unread");Z.find(".unreadmsg_number").text(o[ae.data.cid]>=100?"100+":o[ae.data.cid]).show()}else{Z.removeClass("unread");Z.find(".unreadmsg_number").hide().text("0")}ac.prepend(Z);c()}else{var Y;if(ae.data.to==zmChat.userId){Y=ae.data.fromU}else{if(ae.data.fromU==zmChat.userId){Y=ae.data.to}}if(!zmChat.Friend.__list[Y]){var aa=zmChat.Friend.__list[Y];ac.prepend(N(Y,ae.data.cid,"u/"+aa.n,zmChat.getAvatarLink(aa.a),aa.d,ab,ad,o[ae.data.cid]));c()}else{zmChat.fireGetInfo({u:Y},function(af){if(!af||!af.data){return}ac.prepend(N(Y,ae.data.cid,"u/"+af.data.n,zmChat.getAvatarLink(af.data.a),af.data.d,ab,ad,o[ae.data.cid]));c()})}}}function b(Y){zmCommon.makeRequest("/jpm/ajax","POST",{action:"unread",type:"gettotal"},Y)}function p(){zmEvent.bind("webchat",function(Z){if(Z.data.to==zmChat.userId){b(function(aa){if(aa.msg=="Successfully"){G({pm:aa.total});Y()}else{Y()}});function Y(){if(!zm.isNumber(o[Z.data.cid])){zmCommon.makeRequest("/jpm/ajax","POST",{action:"unread",type:"get",cid:Z.data.cid},function(aa){if(aa.msg=="Successfully"){o[Z.data.cid]=aa.count;F(Z)}})}else{o[Z.data.cid]+=1;F(Z)}}}else{if(Z.data.fromU==zmChat.userId){o[Z.data.cid]=0;F(Z)}}})}function E(ac){var aa=zm("#popup-pmnotification"),Y;var Z=ac.data.msg.replace(new RegExp("^(#[a-f0-9]{1,6})\\s+","g"),""),ab=zm.formatDateTime(ac.data.ts);Y=aa.find(".pmnotify[data-cid='"+ac.data.cid+"']");if(Y.length>0){Y.find(".pmtxt").attr("title",Z).text(Z);Y.find(".notiftimelabel").text(ab);if(o[ac.data.cid]>0){Y.addClass("unread");Y.find(".unreadmsg_number").text(o[ac.data.cid]>=100?"100+":o[ac.data.cid]).show()}else{Y.removeClass("unread");Y.find(".unreadmsg_number").hide().text("0")}aa.prepend(Y);c()}else{aa.prepend(N(null,ac.data.cid,"conversation?id="+ac.data.cid,ac.data.avatar,ac.data.fullname,Z,ab,o[ac.data.cid]));c()}}function r(){zmEvent.bind("webchat.conversation",function(Z){if(Z.data.toUid==zmChat.userId&&Z.data.fromUid!=zmChat.userId){b(function(aa){if(aa.msg=="Successfully"){G({pm:aa.total});Y()}else{Y()}});function Y(){if(!zm.isNumber(o[Z.data.cid])){zmCommon.makeRequest("/jpm/ajax","POST",{action:"unread",type:"get",cid:Z.data.cid},function(aa){if(aa.msg=="Successfully"){o[Z.data.cid]=aa.count;E(Z)}})}else{o[Z.data.cid]+=1;E(Z)}}}else{if(Z.data.fromUid==zmChat.userId){o[Z.data.cid]=0;E(Z)}}})}function B(){}function O(){}function u(){zmCommon.VipUser.fillAll("#popup-notification .mevip",function(){zm("#popup-notification .mevip").removeClass("mevip")})}zmEvent.bind("notify.all",function(Z){for(var Y=0;Y<Z.length;Y++){if(Z[Y].type.indexOf("feed.notify.cate")>-1){zmEvent.fire("feed.notify.cate",Z[Y])}else{zmEvent.fire(Z[Y].type,Z[Y])}}});zmEvent.bind("notify2",function(Y){G({nt:Y.data})});zmEvent.bind("notify.gn",function(Y){G({gn:Y.data})});zmEvent.bind("notify.fr",function(Y){if(Y.data==0&&L.fr!=0){H()}G({fr:Y.data})});zmEvent.bind("webchat.counter",function(ad){try{var ab=zm("#popup-pmnotification"),ae=ad.data.cid,aa=ad.data.count,Z=ad.data.total;if(!ae){return}if(Z>=0){G({pm:Z})}if(ab.length>0&&ab.children().length>0){var Y=ab.find(".pmnotify[data-cid='"+ae+"']");if(Y.length>0){if(o[ae]>0&&aa==0){Y.removeClass("unread");Y.find(".unreadmsg_number").hide().text("0");o[ae]=0}}}}catch(ac){}});zmEvent.bind("webchat.counter.total",function(Z){try{G({pm:Z.total})}catch(Y){}});zmEvent.bind("webchat.conversation.changeName",function(ac){try{var aa=zm("#popup-pmnotification"),ad=ac.data.cid,Y=ac.data.cname;if(!ad||!Y){return}if(aa.length>0&&aa.children().length>0){var Z=aa.find(".pmnotify[data-cid='"+ad+"']");if(Z.length>0){Z.find(".zmnr_username").text(Y).attr("title",Y)}}}catch(ab){}});zmEvent.bind("webchat.conversation.leave",function(ac){try{var aa=zm("#popup-pmnotification"),ad=ac.data.cid,Z=ac.data.uid;if(!ad||!Z){return}if(Z!=zmChat.userId){return}if(aa.length>0&&aa.children().length>0){var Y=aa.find(".pmnotify[data-cid='"+ad+"']");if(Y.length>0){Y.remove();if(aa.children().length==0){aa.html('<div class="zme_notify emptyrow">Bạn không có tin nhắn nào.</div>');zm("#zmpmdetail .zmnotif_viewall").hide()}}}}catch(ab){}});zmEvent.bind("notify.new",function(){O()});zmEvent.bind("feed.notify.cate",function(){J();B()});zmEvent.bind("popup.hide",function(){D()});zmEvent.bind("notify.hide",function(){D()});function D(){zm("#zmntdetail").hide();zm("#zmcp").hide();X.nt=0;zm("#zmpmdetail").hide();X.pm=0;zm("#zmfrdetail").hide();X.fr=0}M.zmNotifications={config:null,init:U,startAlert:w,resetAlert:m,checkEmpty:function(Y){if(Y!="nt"&&Y!="pm"&&Y!="fr"&&Y!="gn"){return}var Z=zm("#"+Y+"list");if(Z&&Z.length&&Z.children().length==0){switch(Y){case"fr":H(true);break;case"pm":W();break;case"nt":V();break;case"gn":y();break}}},removeFrRequest:function(Z){zm(document.getElementById("freq_"+Z)).remove();this.checkEmpty("fr");var Y=zm.intval(zm("#zmfr_num").html());zm("#zmfr_num").html(Y?(Y-1):0)}};function I(){var Y="http://search.me.zing.vn/zingsearch/api/wtauto",af=new zm.Template('<div class="zmserbtn"><span class="zmsprt zmico icochecknote"></span>Bạn</div>								<span class="zmseravt"><a href="{0}/{1}"><img src="{2}" alt=""></a></span>								<div class="zmserinfo"><p class="scanable">{3}</p>{4}</div>'),aa=new zm.Template('<div id="subscribe_btn_{0}" class="zmserbtn"><a class="zmbtn02" href="#" onclick="zmCommon.subscribe({1}); event && event.stopPropagation(); return false;">{2}</a></div>'),ad=new zm.Template('{8}<span class="zmseravt"><a href="{0}/{1}"><img src="{2}" alt=""></a></span>								<div class="zmserinfo">									<p class="scanable">{3}<span class="feed_sprt feed_ico16 ico{7}"></span></p>									<span class="zmsertxtgrey">{4} người {5}</span>								</div>'),ab=new zm.Template('<div class="zmserbtn"><a class="zmbtn02" href="#">Tham gia</a></div>								<span class="zmseravt"><a {5}href="{0}"><img src="{1}" alt=""></a></span>								<div class="zmserinfo">									<p class="scanable">{2}</p>									<span class="zmsertxtgrey">{3}</span>									<span class="zmsertxtgrey">{4} lượt tham gia</span>								</div>'),Z=new zm.Template('<span class="zmseravt"><a href="{0}/{1}"><img src="{2}" alt=""></a></span>								<div class="zmserinfo"><p class="scanable">{3}</p></div>'),ac=new zm.Template('<div id="addfr_btn_{0}"  class="zmserbtn"><a class="zmbtn02" href="#" onclick="zmFriendRequests.sendRequest({1}); event && event.stopPropagation(); return false;">Kết bạn</a></div>'),ae=new zm.Template('{5}<span class="zmseravt"><a href="{0}/{1}"><img src="{2}" alt=""></a></span>								<div class="zmserinfo">									<p class="scanable">{3}</p>{4}</div>');zm("#textSearch").enableAutocomplete(Y,{maxItems:10,minChars:2,scroll:false,width:386,searchResponse:false,matchCase:false,delay:200,followElement:".zm_search",method:"getjson",position:zm(".zmh").css("position"),itemClass:"zmac_item boxsearch",activeItemClass:"hover",listClass:"zmbxsearch",fixShadow:true,excludedClasses:"btn_action",offsetTop:7,scanClass:"scanable",addFooter:function(ah,ai){zm(ai).attr("class","zmserfooter zmac_item");var ag='<a href="'+zmConfig.ME_URL+"/zsearch?q="+ah+'">Xem thêm kết quả cho <strong>'+ah+'</strong><span class="zmsprt icosermore"></span></a>';return ag},beforeSearch:function(){return true},beforeShow:function(){var ag=0;zm("#zme-autocomplete-list li.zme-autocomplete-item").each(function(){if(!zm(this).hasClass("morebxsearch")){ag++}});zm("#searchTotalShown").text(ag)},formatItem:function(ao,an,am,ak,aj){if(ao[4]==-1||ao[4]==-2||ao[4]==-4){zm(aj).addClass("zmsertit").removeClass("zmac_item").css({cursor:"default"})}if(ao[4]==-1){return"Có thể bạn quen"}else{if(ao[4]==-2){return"VIP profile"}else{if(ao[4]==-4){return"Ứng dụng"}}}switch(zm.intval(ao[4])){case 1:return af.render(zmConfig.PROFILE_URL,ao[2],ao[7],ao[0],ao[5]?'<span class="zmsertxtgrey">'+ao[5]+" bạn chung</span>":"");case 3:var al="star",ai="Hâm Mộ";if(ao[9]==2||ao[9]=="2"){al="fan";ai="Thích"}else{if(ao[9]==3||ao[9]=="3"){al="com";ai="Thích"}}var ah=!ao[8]?aa.render(ao[2],"'/act/"+ao[2]+"/lightbox/subcribe?key="+ao[10]+"',"+ao[9]+","+ao[6]+",function(){zm('#subscribe_btn_"+ao[2]+"').remove();}",ai):" ";return ad.render(zmConfig.PROFILE_URL,ao[2],ao[7],ao[0],ao[5],ai.toLowerCase(),ai,al,ah);case 4:var ag="";if(ao[9]=="Tải game"){ag="onclick='return false' "}return ab.render(ao[8],ao[7],ao[0],ao[9],ao[5],ag);case 2:default:if(ao[8]=="owner"){return Z.render(zmConfig.PROFILE_URL,ao[2],ao[7],ao[0])}var ah=ac.render(ao[2],ao[6]+",function(){zm('#addfr_btn_"+ao[2]+"').remove();},{h:'"+ao[9]+"',check_avatar:1,source:116}");return ae.render(zmConfig.PROFILE_URL,ao[2],ao[7],ao[0],ao[5]?'<span class="zmsertxtgrey">'+ao[5]+" bạn chung</span>":"",ah)}return""},makeUrl:function(ag){return Y+"?q="+ag+"&callback=?"},parseData:function(aj){if(!aj){return null}var ag=new Array(),ai=0,ah=true,al=true,ak=true;zm.each(aj,function(){if(this.fullname||this.appname){if(this.isapp){if(ak){ak=false;ag.push(["","","","",-4,0])}}else{if(this.vip!=0){if(al){al=false;ag.push(["","","","",-2,0])}}else{if(!this.fr&&ah){ah=false;ag.push(["","","","",-1,0])}}}var am=[];am[0]=am[1]=this.fullname;am[2]=this.username;am[3]=ai;if(this.isapp){am[0]=am[1]=this.title;am[2]=this.appname;am[4]=4;am[5]=this.total;am[6]=this.appid;am[7]=this.linkimg;am[8]=this.linkapp;am[9]=this.t}else{if(this.vip!=0){am[4]=3;am[5]=this.totalf;am[6]=this.userid;am[7]=this.avt;am[8]=this.isfan?1:0;am[9]=this.vip;am[10]=this.fkey}else{if(this.fr==1){am[4]=1;am[5]=this.mutual;am[6]=this.userid;am[7]=this.avt;am[8]=this.fr}else{am[4]=2;am[5]=this.mutual;am[6]=this.userid;am[7]=this.avt;am[8]=this.fr;am[9]=this.hash}}}ai++;ag.push(am)}});return ag},onItemSelected:function(ag,ah){if(ah=="footer"){zm("#textSearch").val(ag);location.href=zmConfig.ME_URL+"/zsearch?q="+encodeURIComponent(ag)}else{zm("#textSearch").val(ah[0]);if(ah[4]==4){if(ah[9]=="Tải game"){M.open(ah[8],"_blank")}else{M.location.href=ah[8]}}else{M.location.href=zmConfig.PROFILE_URL+"/"+ah[2]}}}}).keyup(function(ag){if(ag.keyCode==13){C();return false}}).focus().placeholder();zm(".zmsrch_btn").bind("click",C)}function C(){var Y=zm.trim(zm("#textSearch").val());if(Y){location.href=zmConfig.ME_URL+"/zsearch?q="+encodeURIComponent(Y)}}function Q(){if(location.host=="me.zing.vn"){zm.get("http://me.zing.vn/zmt",{page:location.href},{dataType:"json"})}else{zm.getJSON("http://me.zing.vn/zmt",{page:location.href})}}zm.ready(function(){x=document.title;k();U();I();Q()})})(window);
