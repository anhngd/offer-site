var zmXCall=(function(window){var resizeCallbacks=new Array(),callbacks={},removeFlags={},html5=false,flash=false,windowEventCallbacks={},trackingWindows={},xcallId,flashCallbacks=new Array();function serialize(data){if(typeof JSON=="object"&&JSON.stringify){return JSON.stringify(data)}if(data==undefined){return"undefined"}if(data==null){return"null"}try{if(typeof data=="string"||data.constructor.toString().match(/string/i)!=null){return'"'+data.replace(/"/g,'\\"')+'"'}}catch(e){}var a;if(Object.prototype.toString.call(data).match(/array/i)!=null){a=new Array();var length=data.length;for(var i=0;i<length;i++){a.push(serialize(data[i]))}return"["+a.join(",")+"]"}if(typeof data=="object"){a=new Array();for(var f in data){a.push('"'+f+'":'+serialize(data[f]))}return"{"+a.join(",")+"}"}return data.toString()}function capitalize(str,sep){if(typeof str!="string"){return null}var ar=str.split(sep);if(ar.length==0){return str}for(var i=0;i<ar.length;i++){if(ar[i]){ar[i]=ar[i].charAt(0).toUpperCase()+ar[i].substr(1)}}return ar.join(sep)}function addWindowHandler(eventName,cb,destWindow){if(!html5){return}if(!windowEventCallbacks[eventName]){windowEventCallbacks[eventName]=[]}windowEventCallbacks[eventName].push(cb);destWindow=destWindow||window.parent;destWindow.postMessage('{xcallAction:"register'+capitalize(eventName)+'Handler"}',"*")}function removeWindowHandler(eventName,cb){if(!html5){return}if(!cb){delete windowEventCallbacks[eventName]}else{if(windowEventCallbacks[eventName]){var i=zm.inArray(cb,windowEventCallbacks[eventName]);i>-1&&windowEventCallbacks[eventName].splice(i,1)}}}function addWindow(eventName,e){if(!trackingWindows[eventName]){trackingWindows[eventName]=[]}var existed=false,wnd=e.source,wnds=trackingWindows[eventName];for(var i=0;i<wnds.length;i++){if(wnds[i]==wnd){existed=true;break}}!existed&&wnds.push(e.source)}function fireWindowEvent(eventName,getValue){var wnds=trackingWindows[eventName];if(!wnds||wnds.length==0){return}var params;if(typeof getValue=="function"){params=getValue()}else{params=getValue}var msg=serialize({xcallAction:"on"+capitalize(eventName),xcallParams:params});for(var i=0;i<wnds.length;i++){wnds[i].postMessage(msg,"*")}}function catchWindowEvent(eventName,data){var callbacks=windowEventCallbacks[eventName];for(var i=0;i<callbacks.length;i++){callbacks[i].call(window,data.xcallParams)}}if(window.postMessage){html5=true;var onmessage=function(e){try{var data=eval("("+e.data+")")}catch(ex){return}if(data.xcallAction){var action=data.xcallAction;if(action.indexOf("register")==0){var name=action.substring(8,action.length-7);if(name){name=name[0].toLowerCase()+name.substr(1);addWindow(name,e)}}else{if(action.indexOf("on")==0){var name=action.substr(2);if(name){name=name[0].toLowerCase()+name.substr(1);catchWindowEvent(name,data)}}else{zmXCall.call(action,data.xcallParams,window,e.source)}}}};if(window.attachEvent){window.attachEvent("onmessage",onmessage)}else{window.addEventListener("message",onmessage,false)}if(typeof zm!="undefined"){zm(window).scroll(function(){fireWindowEvent("scroll",zmXCall.getTopSelf)}).resize(function(){fireWindowEvent("windowResize",zmXCall.getViewportSelf)})}}var m=navigator.userAgent.toLowerCase().match(/(^|\s)(firefox|safari|opera|msie|chrome)[\/:\s]([\d\.]+)/)||["","","0.0"],msie=m[2]=="msie",opera=m[2]=="opera";if(!window.postMessage||msie){var flashUrl=window.zmXCall_FlashFile||"http://static.me.zing.vn/swf/zmxcall-1.00.swf",playerId="zmxcall-obj",oAttrs={id:playerId,type:"application/x-shockwave-flash",width:"0",height:"0",data:flashUrl},oParams={movie:flashUrl,allowScriptAccess:"always"};if(msie&&!opera){oAttrs.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}if((!msie)||opera){var e=document.createElement("OBJECT");for(var attrName in oAttrs){e.setAttribute(attrName,oAttrs[attrName])}for(var attrName in oParams){var p=document.createElement("PARAM");p.setAttribute("name",attrName);p.setAttribute("value",oParams[attrName]);e.appendChild(p)}document.body.appendChild(e)}else{var html="<object ";for(var attrName in oAttrs){html+=attrName+'="'+oAttrs[attrName]+'" '}html+=">";for(var attrName in oParams){html+='<param name="'+attrName+'" value="'+oParams[attrName]+'">'}html+="</object>";setTimeout(function(){var e=document.getElementById("zmxcall-obj");if(!e){e=document.createElement("DIV");e.setAttribute("id","zmxcall-obj");document.body.appendChild(e)}e.outerHTML=html},200)}}return{DEFAULT_PROXY_VERSION:"1.00",DEFAULT_HOST:"me.zing.vn",version:"1.21",window:window,enableFlash:function(){flash=true;for(var i=0,fn;fn=flashCallbacks[i];i++){fn()}},flashReady:function(fn){if(typeof fn=="function"&&flashCallbacks.indexOf(fn)>=0){flashCallbacks.push(fn)}},onresize:function(callback){if(callback){resizeCallbacks.push(callback)}else{for(var i=0;i<resizeCallbacks.length;i++){resizeCallbacks[i]()}}},getXCallID:function(){var fo=document.getElementById("zmxcall-obj");if(fo){return fo.getChannelID()}},setXCallID:function(id){xcallId=id},register:function(name,callback,remove){callbacks[name]=callback;if(remove){removeFlags[name]=true}else{if(removeFlags[name]){delete removeFlags[name]}}},callByFlash:function(message){try{var o=eval("("+message+")");if(o.name){zmXCall.call(o.name,o.params,window)}}catch(e){}},call:function(name,params,wnd,source){if(!callbacks[name]){return}try{var rs=callbacks[name].call(wnd,params,source);if(rs){this.callParent(rs.callback,rs.params,rs.options,rs.window,true)}}catch(e){}if(removeFlags[name]){delete removeFlags[name];delete callbacks[name]}},callParent:function(funcName,params,options,wnd,postBack){if(!wnd){wnd=window}try{if(html5&&(wnd.parent==window||!postBack||window.opener==wnd)){if(!postBack&&window.opener!=wnd){wnd=wnd.parent}wnd.postMessage(serialize({xcallAction:funcName,xcallParams:params}),"*");return}}catch(e){}if(flash){if(options&&options.xcallId){xcallId=options.xcallId}if(!xcallId){var uri=window.location.href,qs={};uri.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function($0,$1,$2,$3){qs[$1]=$3});xcallId=qs.zmxcid}if(xcallId){var fo=document.getElementById("zmxcall-obj"),msg=serialize({name:funcName,params:params});fo.callParentViaFlash(xcallId,msg);return}}options=options||{};options.protocol=options.protocol||window.location.protocol;options.host=options.host||zmXCall.DEFAULT_HOST;options.version=options.version||zmXCall.DEFAULT_PROXY_VERSION;var ifid="xcall-if-"+Math.floor(Math.random()*100),url=options.protocol+"//"+options.host+"/xcall.proxy-"+options.version+".html#"+encodeURIComponent(funcName+","+serialize(params)),tried=0;function doCall(){var e=wnd.document.createElement("IFRAME");e.style.visibility="hidden";e.style.display="none";e.width="0";e.height="0";e.src=url;e.id=ifid;try{wnd.document.body.appendChild(e)}catch(e){tried++;if(tried<3){setTimeout(doCall,200)}return}setTimeout(function(){try{var e=wnd.document.getElementById(ifid);wnd.document.body.removeChild(e)}catch(e){}},10000)}doCall()},resizeParent:function(params,options){if(typeof params=="string"||params.constructor.toString().match(/string/i)!=null){params={id:params}}if(!params.height){var D=document;params.height=Math.max(Math.max(D.body.scrollHeight,D.documentElement.scrollHeight),Math.max(D.body.offsetHeight,D.documentElement.offsetHeight),Math.max(D.body.clientHeight,D.documentElement.clientHeight))}this.callParent("resize",params,options)},setHashParent:function(hash,options){this.callParent("setHash",hash,options)},getTop:function(callback,options){var cbname="getTop"+Math.floor(Math.random()*100);this.register(cbname,callback,true);var params={host:window.location.host,cb:cbname};this.callParent("getTop",params,options)},getTopSelf:function(){var top,height,wnd=zmXCall.window,B=wnd.document.body,D=wnd.document.documentElement;if(typeof wnd.pageYOffset!="undefined"){top=wnd.pageYOffset}else{top=((D&&D.scrollTop)?D:B).scrollTop}if(typeof wnd.innerHeight!="undefined"){height=wnd.innerHeight}else{height=((D&&D.clientHeight)?D:B).clientHeight}return{top:top,height:height,docHeight:Math.max(0,document.body.offsetHeight)}},getViewport:function(callback,options){var cbname="getViewport"+Math.floor(Math.random()*100);this.register(cbname,callback,true);var params={host:window.location.host,cb:cbname};this.callParent("getViewport",params,options)},getViewportSelf:function(){var result={},wnd=zmXCall.window,docElem=wnd.document.documentElement,body=wnd.document.body;if(window.innerWidth){result.width=window.innerWidth;result.height=window.innerHeight}else{if(docElem&&docElem.offsetWidth){result.width=docElem.offsetWidth;result.height=docElem.offsetHeight}else{result.width=body.offsetWidth;result.height=body.offsetHeight}}if(typeof window.pageYOffset=="number"){result.offsetY=window.pageYOffset;result.offsetX=window.pageXOffset}else{if(docElem&&(docElem.scrollLeft||docElem.scrollTop)){result.offsetY=docElem.scrollTop;result.offsetX=docElem.scrollLeft}else{if(body&&(typeof body.scrollLeft=="number")){result.offsetY=body.scrollTop;result.offsetX=body.scrollLeft}}}return result},addScrollHook:function(cb,destWindow){addWindowHandler("scroll",cb,destWindow)},onWindowResize:function(cb,destWindow){addWindowHandler("windowResize",cb,destWindow)},bindEvent:addWindowHandler,unbindEvent:removeWindowHandler,fireEvent:fireWindowEvent,openFullFrame:function(params,options){this.callParent("openFullFrame",params,options)},closeFullFrame:function(params,options){this.callParent("closeFullFrame",params,options)},openBoxy:function(title,url,width,height,options,proxyOptions){this.callParent("openBoxy",zm.extend({title:title,url:url,width:width,height:height},options),proxyOptions)},closeBoxy:function(options){this.callParent("closeBoxy",null,options)}}})(window);zmXCall.register("resize",function(a){if(!a.height){return}var b=zm(a.id?"#"+a.id:document);b.css("height",a.height+"px");zmXCall.onresize()});zmXCall.register("getTop",function(d,c){var a=zmXCall.getTopSelf(),b={host:d.host};b.version=d.version||zmXCall.DEFAULT_PROXY_VERSION;return{callback:d.cb,params:a,options:b,window:c||this}});zmXCall.register("setHash",function(a){window.location.hash=a});zmXCall.register("getViewport",function(c,b){var a={host:c.host,version:c.version||zmXCall.DEFAULT_PROXY_VERSION};return{callback:c.cb,params:zmXCall.getViewportSelf(),options:a,window:b||this}});zmXCall.register("openFullFrame",function(data){var HEADER_SIZE=data.headerSize?data.headerSize:50,header=zm(".zmh"),z=zm("#fullsized-frame"),vp=zm.getViewport(),styleEl,sbWidth=vp.width-zm(document.body).width(),updateSizing=function(){if(zm.browser.msie&&zm.browser.version<"7"){vp=zm.getViewport();z=zm("#fullsized-frame");z.css("height",(vp.height-HEADER_SIZE)+"px");var h=zm(z.children()[1]).height();if(h+2<vp.height-HEADER_SIZE){h=vp.height-HEADER_SIZE}else{h+=2}zm(z.children()[0]).css("height",h+"px");zm("#fullsized-closebtn").css("left",(vp.width-32)+"px")}},pressKey=function(e){if(e.keyCode==27){zm("#fullsized-closebtn").click()}};if(header.css("position")=="fixed"){HEADER_SIZE=header.outerHeight()}else{if(header.size()>0){HEADER_SIZE=0}}if(zm.browser.msie&&zm.browser.version<"8"){sbWidth=0;styleEl=document.createElement("STYLE");styleEl.setAttribute("type","text/css");styleEl.styleSheet.cssText="html {overflow: hidden} #fullsized-frame{overflow-y: auto !important}";document.getElementsByTagName("head")[0].appendChild(styleEl)}else{zm(document.body).css({"margin-right":sbWidth+"px",overflow:"hidden"})}if(z.size()==0){var h=parseInt(data.height?data.height:500),w=data.width?data.width:980,e=zm.createElement("DIV",{id:"fullsized-frame"},{left:"0",width:"100%"}),ec=zm.createElement("DIV",{},{position:"relative",border:"1px #000 solid",width:w+"px",height:h+"px",margin:"auto"}),f=zm.createElement("IFRAME",{src:data.url,border:0},{border:"0px none",height:h+"px",width:w+"px"}),closebtn=zm.createElement("DIV",{id:"fullsized-closebtn",title:"Đóng"},{cursor:"pointer",top:(HEADER_SIZE-20)/2+"px",left:(vp.width-42)+"px",width:"20px",height:"20px",position:"fixed",zIndex:40,background:"transparent url(http://stc.ugc.zdn.vn/photo_v4/zme/images/imgsprtpho_1.06.gif) 0 -149px no-repeat"});if(data.onload){f.onload=data.onload}ec.appendChild(f);e.appendChild(ec);if(zm.browser.msie&&zm.browser.version<"7"){zm(e).css({height:(vp.height-HEADER_SIZE)+"px",position:"absolute",top:(vp.offsetY+HEADER_SIZE)+"px",width:"100%"})}else{zm(e).css({position:"fixed",top:HEADER_SIZE+"px",bottom:0})}var ctncss={"background-color":"#fff"};if(HEADER_SIZE==0){ctncss.top="33px"}zm(ec).css(ctncss);document.body.appendChild(e);z=zm(e);z.css({"z-index":37,"overflow-x":"hidden","overflow-y":e.scrollHeight-e.clientHeight<=5?"hidden":"auto"});if(zm.browser.msie&&zm.browser.version<"9"){z.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr=#B2000000, endColorstr=#B2000000)")}else{z.css("background-color","rgba(0, 0, 0, 0.7)")}z.click(function(){if(this.id=="fullsized-frame"){zm("#fullsized-closebtn").attr("data-from","background").click()}});zm(window).bind("resize",updateSizing);document.body.appendChild(closebtn);zm(document).keydown(pressKey);zm(closebtn).click(function(){var btn=zm("#fullsized-closebtn"),hidetype=btn.attr("data-from")||"button";try{if(eval(data.beforeHide+'("'+hidetype+'");')===false){return}}catch(ex){}zm(window).unbind("resize",updateSizing);zm(document).unbind("keydown",pressKey);btn.remove();zm("#fullsized-frame").remove();zm(document.body).css({"margin-right":"auto",overflow:"auto"});if(zm.browser.msie&&zm.browser.version<"8"){zm(styleEl).remove()}window.zmChat&&zmChat.displayTicker("revert");window.zmCommon&&zmCommon.displayLeftmenu&&zmCommon.displayLeftmenu(true);try{eval(data.onclose+"();")}catch(ex){}});if(window.zmChat){zmChat.displayTicker(false)}else{if(!window.zmChatParams){window.zmChatParams={}}zmChatParams.displayFirst=false}window.zmCommon&&zmCommon.displayLeftmenu&&zmCommon.displayLeftmenu(false)}else{zm("#fullsized-frame iframe").bind("load",data.onload)}z.show()});zmXCall.register("resizeFullFrame",function(b){for(var a in b){if(a!="width"&&a!="height"){delete b[a]}else{b[a]+="px"}}if(zm.objectLength(b)==0){return}zm("#fullsized-frame").children().css(b);zm("#fullsized-frame iframe").css(b)});zmXCall.register("closeFullFrame",function(){zm("#fullsized-closebtn").attr("data-from","call").click()});zmXCall.register("openBoxy",function(b){if(!zmXCall.boxy){zmXCall.boxy=new zm.Boxy({title:"",content:'<iframe id="xcallBoxyFrame" frameborder="0"></iframe>',footer:false})}b.footer=!!b.okButton;zmXCall.boxy.changeSettings(b);var a=zm("#xcallBoxyFrame");b.url&&a.attr("src",b.url);if(!a.attr("src")){return}b.width&&a.css("width",b.width+"px");b.height&&a.css("height",b.height+"px");if(!zmXCall.boxy.isShowing()){zmXCall.boxy.show()}else{zmXCall.boxy.center()}});zmXCall.register("closeBoxy",function(){zmXCall.boxy&&zmXCall.boxy.hide()});
