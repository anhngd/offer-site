zm.ready(function() {

    var interval = null,
        current_item = 1,
        item_height = zm('.slideright_banner .slide li').height(),
        last_position = zm('.slideright_banner .slide li').length - 2;
    zm('.slideright_banner .slide li').each(function(i, item) {
        zm(item).css({
            top: (i * item_height) + 'px'
        }).find('a').attr('rel', i).click(function() {
            clearInterval(interval);
            setThumbPosition(zm(item));
            setBigData(zm(item));
            setClickInterval();
            return false;
        });
    });
    
    zm('.slideright_banner').hover(function() {
       zm('.slide_wrp .slidecontrol').show();
    }, function() {
       zm('.slide_wrp .slidecontrol').hide(); 
    });
    
    zm('.slidetoparr').click(function() {
        clearInterval(interval);
        current_item = parseInt(current_item) - 1;
        if (current_item < 0) {
            current_item = zm('.slideright_banner .slide li').length - 1;
        }
        setScroll(current_item);
        setClickInterval();
        return false;
    });

    zm('.slidebotarr').click(function() {
        clearInterval(interval);
        current_item = parseInt(current_item) + 1;
        if (current_item >= zm('.slideright_banner .slide li').length) {
            current_item = 0;
        }
        setScroll(current_item);
        setClickInterval();
        return false;
    });

    setClickInterval();

    function setClickInterval() {
        interval = setInterval(function() {
            current_item = parseInt(current_item) + 1;
            if (current_item >= zm('.slideright_banner .slide li').length) {
                current_item = 0;
            }
            setScroll(current_item);
        }, 3000);
    }
    
    function setScroll(index) {
        var item = zm('.slideright_banner .slide li').get(index);
        setThumbPosition(item);
        setBigData(item);
    }

    function setThumbPosition(item) {
        var frame_slide = 60;
        zm('.slideright_banner .slide li').removeClass('active');
        current_item = item.addClass('active').find('a').attr('rel');

        if (current_item <= last_position) {
            var pos;
            if(current_item == last_position) {
                pos = - (current_item - 2) * item_height;
            } else if (current_item == 0){
                pos = 0;
            } else 
                pos = - (current_item - 1) * item_height;
            zm('.slideright_banner .slide li').each(function(i, item) {
                var top = (i * item_height + pos);
                zm(item).attr('rel', i).css({top: top + 'px'});
            });
        }
        if (current_item == 0 || current_item >= last_position) {
            frame_slide = current_item == 0 ? 0 : (current_item - last_position + 2) * 60;
        }
        zm('.frame_slide').css({top: frame_slide + 'px'});
    }

    function setBigData(item) {
        var href = item.children('a').attr('href'),
                img_url = item.children('a').attr('banner'),
                img_caption = item.find('.banner_caption').html();
        zm('.banner #main_banner').attr('href', href);
        zm('.banner #main_banner img').attr('src', img_url);
        zm('.topbanner_bar p').html(img_caption);
    }
});

