zmCore.install("autocomplete",{enableAutocomplete:function(r,e){if(!r){return false}this.disableAutocomplete();var s={};zm.extend(s,zm.autocomplete.defOptions,e);s.url=zm.isString(r)?r:"";var j=this,n=new zm.autocomplete.selector(this,s),i=new zm.autocomplete.cache(s),f="";zm.isString(r)?f=r:i.add("",r);var b=0,o=false;var t=function(y){b=1;var v=y.keyCode||y.which,A=n.isVisible(),z=y.type=="keydown"||zm.browser.opera,u=s.useCtrlKeyOnChange;switch(v){case 38:z&&a(this,y,A,u,"prev");break;case 40:z&&a(this,y,A,u,"next");break;case 33:z&&a(this,y,A,u,"pageUp");break;case 34:z&&a(this,y,A,u,"pageDown");break;case 9:case 13:var x=n.getSelected();if(x&&A&&y.type!="keyup"){o=true;n.select(x,1)}if(o){y.stopAllHandlers=true;if(y.type=="keyup"){o=false}return false}break;case 27:if(A&&z){y.stopAllHandlers=true;n.hide();return false}break;case 229:if(z){var w=(y.key||y.keyIdentifier).toLowerCase();if(w=="up"){a(this,y,A,u,"prev")}else{if(w=="down"){a(this,y,A,u,"next")}else{if(w=="pagedown"){a(this,y,A,u,"pageDown")}else{if(w=="pageup"){a(this,y,A,u,"pageUp")}else{m(this)}}}}}break;default:z&&m(this);break}return true},h=function(){!n.isVisible()&&(b++>1)&&m(this)},c=function(){b++};if(zm.browser.opera){this.keypress(t,-1)}else{this.keydown(t,-1).keyup(t,-1).keypress(t,-1)}this.click(h).focus(c);zm("#zmac").clickOutsideWith(this);this.attr("autocomplete","off");if(s.disableAfterSelect){this.each(function(){var w,u=s.clearButton;if(zm.isString(u)&&u){w=u}else{w="zmac_clear_"+ ++zm.plugins.autocomplete.count;zm(document.body).append('<a href="#" class="zmac_clear" id="'+w+'" title="Nhập lại" style="display:none;"></a>')}zm.data(this,"autocomplete.clear",w);var v=this;zm("#"+w).click(function(){zm(this).hide();var x=zm.data(v,"autocomplete.value");if(x){v.value=x}zm(v).attr("disabled","").removeClass(s.disabledClass).focus();zm.isFunction(s.onEnable)&&s.onEnable(v,x);return false})})}this.data("autocomplete",j).data("autocomplete.settings",s).data("autocomplete.selector",n).data("autocomplete.cache",i).data("autocomplete.callbacks",{keydown:t,keypress:t,keyup:t,click:h,focus:c});function m(u){var v=zm.data(u,"autocomplete.timeout");v&&clearTimeout(v);v=setTimeout(function(){zm.data(zm("#zmac")[0],"autocomplete.input",u);var y=s.beforeSearch,w=true;if(zm.isFunction(y)){w=y(u)}if(w==false){return}var x=d(u);if(x.length<s.minChars){l()}else{g(u,x,k,l)}},s.delay);zm.data(u,"autocomplete.timeout",v)}function a(x,w,y,u,v){if(y){w.preventDefault();n[v]&&n[v]()}else{if(u){m(x)}}}function d(u){if(zm.isFunction(s.getTerm)){return s.getTerm(u)}else{return u.value}}function k(u,v){if(zm.objectLength(v)>0&&b){q();n.setData(u,v);if(n.countItem()>0){n.show();zm.plugins.autocomplete.curSelector=n}else{n.hide();zm.plugins.autocomplete.curSelector=null}j.removeClass(s.loadingClass)}else{l()}}function l(){q();n.hide();zm.plugins.autocomplete.curSelector=null;j.removeClass(s.loadingClass)}function q(){var u=zm.plugins.autocomplete.curSelector;u&&u!=n&&u.hide()}function p(u,v){var w=u;if(zm.isFunction(s.parseData)){w=s.parseData(u)}s.cacheLength>0&&i.add(v,w);return w}function g(x,y,C,w){var B,A;if(s.cacheLength>0){B=i.load(y)}y=zm.trim(y.toLowerCase());if(s.hasGroup){A=0;zm.each(B,function(E,D){if(D&&D.list&&D.list.length){A+=D.list.length}})}else{A=zm.objectLength(B)}if(A>0){C(y,B)}else{if(f.length>0){j.addClass(s.loadingClass);var z=f,u=s.method.toLowerCase();if(s.makeUrl){z=s.makeUrl(y)}else{if(u!=="post"){z=f+"?"+s.query+"="+encodeURIComponent(d(x))}}switch(u){case"post":var v=s.postData;v.keyword=d(x);zm.post(z,v,{dataType:"json"},function(E){if(y==zm.trim(d(x)).toLowerCase()){var D=p(E,y);C(y,D)}},w);break;case"get":zm.get(z,{dataType:"json"},function(E){if(y==zm.trim(d(x)).toLowerCase()){var D=p(E,y);C(y,D)}},w);break;case"getjson":zm.getJSON(z,{},function(E){if(y==zm.trim(d(x)).toLowerCase()){var D=p(E,y);C(y,D)}},w);break}}else{n.empty();w()}}}return this},flushCache:function(){var a=zm.data(this[0],"autocomplete.cache");a&&a.flush()},disableAutocomplete:function(){this.each(function(){var c=zm.data(this,"autocomplete"),b=zm.data(this,"autocomplete.callbacks");if(b){for(var a in b){c.unbind(a,b[a])}}clearTimeout(zm.data(this,"autocomplete.timeout"));zm.removeData(this,"autocomplete");zm.removeData(this,"autocomplete.settings");zm.removeData(this,"autocomplete.selector");zm.removeData(this,"autocomplete.cache");zm.removeData(this,"autocomplete.timeout");zm.removeData(this,"autocomplete.callbacks");zm.removeData(this,"autocomplete.clear");zm.removeData(this,"autocomplete.value")});this.unbindAll("clickoutside");this.attr("autocomplete","");return this},hideAutocomplete:function(){var a=this.data("autocomplete.selector");a&&a.hide()},changeAutocomplete:function(a,b){var c=this.data("autocomplete.settings");if(b){c=a}else{zm.extend(c,a)}}},function(){zm.plugins.autocomplete.count=0;zm.plugins.autocomplete.hide=function(){var a=zm.plugins.autocomplete.curSelector;a&&a.hide();zm.plugins.autocomplete.curSelector=null};zm.ready(function(){var a=zm.createElement("DIV",{id:"zmac","class":"zmdisbx_border"},{display:"none"});document.body.appendChild(a);zm(a).clickOutside(zm.plugins.autocomplete.hide).html('<div id="zmac_content" class="zmdisbx_inner"></div>');zm.plugins.autocomplete.sui=new zm.ScrollableUI({content:'<ul class="listag" id="zmac_list"></ul>',height:200});zm("#zmac_content").append(zm.plugins.autocomplete.sui.getElement());zm(window).resize(function(){var b=zm.plugins.autocomplete.curSelector;b&&b.isVisible()&&b.show()})},-1)});zmCore.autocomplete={defOptions:{maxItems:100,delay:500,minChars:2,matchCase:false,matchContains:false,cacheLength:30,autoFill:false,hoverAutoFill:false,selectFirst:false,useCtrlKeyOnChange:true,formatItem:false,onItemSelected:false,method:"GET",query:"q",postData:{},searchResponse:true,highlight:function(g,e,b){var a="g";if(!b.matchCase){a+="i"}var d=b.matchContains,f=new RegExp((d?"(":"(^|\\W+)(")+e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)",a),c=d?"<strong>$1</strong>":"$1<strong>$2</strong>";return ViString.replace(f,c,g)},scroll:true,scrollHeight:200,pageItems:10,disableAfterSelect:false,maxDisabledTextLength:0,position:"absolute",excludedClasses:"",loadingClass:"zmac_loading",itemClass:"zmac_item",activeItemClass:"zmac_activeItem",disabledClass:"zmac_disabled",coverClass:"zmdisbx_border",listClass:"listag"}};zmCore.autocomplete.cache=function(b){var d={},c=0;function a(h){var e,f=-1;for(var g in d){g=g.toString();if(g.length<=f){continue}if(ViString.indexOf(g,h,"i")==0){e=d[g];f=g.length}}return e}return{settings:b,add:function(e,f){if(c>this.settings.cacheLength){this.flush()}if(!d[e]){c++}d[e]=f},load:function(f){if(!c){return null}var e,h=this.settings;if(d[f]){e=d[f];if(zm.isFunction(h.search)){e=h.search(e,f,true)}}else{var g=a(f);if(zm.isFunction(h.search)){e=h.search(g,f,false)}var i=f.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1");if(!e){e=zm.isArray(g)?new Array():{}}zm.each(g,function(l,q){var o=(h.matchContains?"(":"(^|\\W+)(")+i+")(?![^<>]*>)",j=h.matchCase?"g":"gi";if(h.hasGroup){var p=q.list,n=new Array();q=zm.extend({},q);zm.each(p,function(r,s){var m=s;if(zm.isFunction(h.formatCacheSearch)){m=h.formatCacheSearch(s)}if(zm.isString(m)&&ViString.search(new RegExp(o,j),m)>=0){n.push(s)}});q.list=n;e[l]=q}else{var k=q;if(zm.isFunction(h.formatCacheSearch)){k=h.formatCacheSearch(q)}if(zm.isString(k)&&ViString.search(new RegExp(o,j),k)>=0){e[l]=q}}});if(!h.url){this.add(f,e)}}return e},flush:function(){d={};c=0}}};zmCore.autocomplete.selector=function(i,k){var c=new Array(),j=-1,f,h=false,d=k,g=["padding-left","padding-right","border-left-width","border-right-width"];function b(){if(d.autoFill){if(this.getSelected()){var m=zm.data(this.getSelected(),"autocomplete.item");if(m){var l=m.key;if(zm.isFunction(d.formatInput)){l=d.formatInput(m.value,m.group)}if(l==false){l=m.key}i[0].value=l}}}}function e(){var l=this;zm("#zmac_list li.zmac_item").each(function(){zm(this).hover(function(){c[j]&&zm(c[j]).removeClass(d.activeItemClass);j=zm.inArray(this,c);d.hoverAutoFill&&b();zm(this).addClass(d.activeItemClass);f=this},function(){zm(this).removeClass(d.activeItemClass);f=null}).click(function(){var o=d.excludedClasses&&d.excludedClasses.split(" ");if(this.tagName.toLowerCase()=="li"&&!a(this,o)){l.select(this,0)}else{for(var m=0,n;n=zm(this).parents()[m];m++){if(a(n,o)){break}if(n.tagName.toLowerCase()=="li"){l.select(n,0);break}}}return d.bubbleClickOnItem})})}function a(o,p){if(p){var m=zm(o);for(var n=0,l;l=p[n];n++){if(m.hasClass(l)){return true}}}return false}return{getInput:function(){return i},setData:function(m,p){this.empty();if(!m&&!p&&zm.objectLength(p)==0){return}var q=0,r,A,t=zm("#zmac_list"),s=zm.createElement("LI",{"class":d.itemClass});if(zm.isFunction(d.addHeader)){r=d.addHeader(m,s)}if(r){zm(s).html(r);t.append(s);zm.data(s,"autocomplete.item",{key:m,value:"footer"});c[q]=s}else{delete s}for(var n in p){if(q>=d.maxItems){break}if(d.hasGroup){if(p[n].list&&p[n].list.length>0){var z=p[n].title,y=p[n].list,l=zm.createElement("LI"),v=zm.createElement("UL");if(zm.isFunction(d.formatTitle)){z=d.formatTitle(z,n)}else{z="<h3>"+z+"</h3>"}d.groupClass&&zm(l).addClass(d.groupClass);zm(l).append(z).append(v);var o=1;for(var u in y){var x=(d.groupMaxItems&&d.groupMaxItems[n])||0;if(q>d.maxItems||(x>0&&o>x)){break}if(this.renderItem(m,zm.isArray(y)?y[u]:u,y[u],n,q,v)){q++;o++}}zm.isFunction(d.formatGroup)&&d.formatGroup(l,n,p[n]);t.append(l)}}else{this.renderItem(m,zm.isArray(p)?p[n]:n,p[n],null,q,t[0])&&q++}}var w=zm.createElement("LI",{"class":d.itemClass});if(zm.isFunction(d.addFooter)){A=d.addFooter(m,w)}if(A){zm(w).html(A);t.append(w);zm.data(w,"autocomplete.item",{key:m,value:"footer"});c[q]=w}else{delete w}if(c.length<1){return}if(d.selectFirst){this.move(1)}e.call(this)},renderItem:function(l,r,o,q,m,p){if(!o){return false}var s=zm.createElement("LI",{"class":d.itemClass}),n=o.toString(),t;if(zm.isFunction(d.formatItem)){t=d.formatItem(o,r,q,d.maxItems,s)}if(t!=false){n=t||n;if(zm.isFunction(d.highlight)){n=d.highlight.call(this,n,l,d)||n}zm(s).html(n);zm.data(s,"autocomplete.item",{key:r,value:o,group:q});p.appendChild(s);c[m]=s;return true}return false},isVisible:function(){return h},show:function(){if(c.length==0){return}var l=d.followElement?zm(d.followElement):i;if(!l){return}zm.isFunction(d.beforeShow)&&d.beforeShow(i[0]);var C=zm("#zmac"),x=zm("#zmac_content"),p,G,s,n,A=l.outerHeight();switch(d.position){case"absolute":p=l.offset(true);break;case"fixed":p=l.offset();break}s=p.top+A;n=p.left;if(d.position=="fixed"&&zm.browser.msie&&zm.browser.version<7){if(!zm.data(C[0],"autocomplete.fixPosition")){zm(window).scroll(function(){C.css({top:(s+document.documentElement.scrollTop)+"px",left:(n+document.documentElement.scrollLeft)+"px"})});zm.data(C[0],"autocomplete.fixPosition",true)}var v=l.offset(true);G="absolute";s=v.top+A;n=v.left}else{G=d.position}h=true;zm("#zmac_list").attr("class",d.listClass);var m=zm.plugins.autocomplete.sui,F=[x,C],r=0;for(var z=0,D;D=F[z];z++){for(var y=0,q;q=g[y];y++){r+=zm.intval(D.css(q))}}var w=d.width||(l.outerWidth()-r);m.setWidth(w);C.attr("class",d.coverClass).css({width:w+"px","z-index":d.zIndex?d.zIndex:"",top:"-9999px",left:"-9999px"}).show();if(d.scroll){m.enableScrollTop();m.setMaxHeight(d.scrollHeight)}else{m.disableScrollTop()}var E=C.outerHeight(),B=zm.getViewport(),t,u=s;switch(d.position){case"absolute":t=zm(document.body).outerHeight(true);u=s-B.offsetY;break;case"fixed":t=B.height;break}if(u+(d.scrollHeight||E)>t&&u-E-A>0){s-=E+A}if(typeof d.offsetLeft=="number"){s+=d.offsetTop}if(typeof d.offsetLeft=="number"){n+=d.offsetLeft}C.css({position:G,top:s+"px",left:n+"px"});i.markClickOutside()},hide:function(l){if(l){h=false}else{if(this.isVisible()){zm.isFunction(d.beforeHide)&&d.beforeHide(i[0]);h=false;zm.plugins.autocomplete.sui.scrollTop(0).hideScrollbar(false);zm("#zmac").hide()}}},move:function(m,l){if(c.length<1){return}c[j]&&zm(c[j]).removeClass(d.activeItemClass);if(c.length==1&&j!=-1){j=-1;return}j+=m;if(j<0){j=c.length-1}else{if(j>=c.length){j=0}}if(!c[j]||!zm(c[j]).hasClass("zmac_item")){if(!l){l=0}if(l<c.length-1){this.move(m,l+1)}return}b.call(this);zm(c[j]).addClass(d.activeItemClass);f&&zm(f).removeClass(d.activeItemClass);f=null;if(d.scroll){setTimeout(function(){if(c.length<1||j<0){return}var s=zm.plugins.autocomplete.sui,r=0,o=s.scrollTop(),q=s.getHeight();for(var p=0;p<j;p++){r+=zm(c[p]).outerHeight()}var n=zm(c[j]).outerHeight();if(r+n-o>=q){s.scrollTo(r+n-q)}else{if(r<o){s.scrollTo(r)}}},100)}},next:function(){c.length>0&&this.move(1)},prev:function(){c.length>0&&this.move(-1)},pageUp:function(){if(c.length>0){(j-d.pageItems)<0?this.move(-j):this.move(-d.pageItems)}},pageDown:function(){if(c.length>0){(j+d.pageItems)>=c.length?this.move(c.length-1-j):this.move(d.pageItems)}},getSelected:function(){if(f){return null}return c[j]},empty:function(){zm("#zmac_list").empty();c.splice(0,c.length);j=-1},countItem:function(){return c.length},select:function(t,r){var n=zm.data(t,"autocomplete.item");if(!n){return}var m=n.value;if(zm.isFunction(d.formatInput)){m=d.formatInput.call(i[0],m,n.group)}if(m==false){m=n.key}else{if(m!=true){if(d.disableAfterSelect){var p=d.maxDisabledTextLength;if(p>0&&zm.isString(m)){zm.data(i[0],"autocomplete.value",m);if(m.length>p){m=m.substr(0,p-3)+"..."}}i.attr("disabled","disabled").addClass(d.disabledClass);var o=zm("#"+zm.data(i[0],"autocomplete.clear"));if(!zm.isString(d.clearButton)||!d.clearButton){var q=i.offset(true),s=i.outerHeight(),l=i.outerWidth();o.css({top:Math.floor(q.top+(s-16>0?s-16:0)/2)+"px",left:Math.floor(q.left+l-17)+"px"})}o.show()}i.val(m)}}!d.disableAfterSelect&&i.focus();this.hide();j=-1;zm.isFunction(d.onItemSelected)&&d.onItemSelected.call(t,n.key,n.value,n.group,r)}}};if(typeof ViString=="undefined"){var ViString=(function(){var c=[["á","à","ả","ã","ạ","â","ấ","ầ","ẩ","ẫ","ậ","ă","ắ","ằ","ẳ","ẵ","ặ"],["Á","À","Ả","Ã","Ạ","Â","Ấ","Ầ","Ẩ","Ẫ","Ậ","Ă","Ắ","Ằ","Ẳ","Ẵ","Ặ"],["é","è","ẻ","ẽ","ẹ","ê","ế","ề","ể","ễ","ệ"],["É","È","Ẻ","Ẽ","Ẹ","Ê","Ế","Ề","Ể","Ễ","Ệ"],["ú","ù","ủ","ũ","ụ","ư","ứ","ừ","ử","ữ","ự"],["Ú","Ù","Ủ","Ũ","Ụ","Ư","Ứ","Ừ","Ử","Ữ","Ự"],["í","ì","ỉ","ĩ","ị"],["Í","Ì","Ỉ","Ĩ","Ị"],["ý","ỳ","ỷ","ỹ","ỵ"],["Ý","Ỳ","Ỷ","Ỹ","Ỵ"],["ó","ò","ỏ","õ","ọ","ô","ố","ồ","ổ","ỗ","ộ","ơ","ớ","ờ","ở","ỡ","ợ"],["Ó","Ò","Ỏ","Õ","Ọ","Ô","Ố","Ồ","Ổ","Ỗ","Ộ","Ơ","Ớ","Ờ","Ở","Ỡ","Ợ"],["đ"],["Đ"]],d=["a","A","e","E","u","U","i","I","y","Y","o","O","d","D"];function b(g){if(typeof g=="string"){for(var f=0;f<c.length;f++){for(var e=0;e<c[f].length;e++){g=g.replace(new RegExp(c[f][e],"g"),d[f])}}}return g}function a(e){return(e instanceof RegExp)?new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":"")):e}return{normalize:function(g){if(g instanceof RegExp){var f=g.source,e="";if(g.global){e+="g"}if(g.ignoreCase){e+="i"}if(g.multiline){e+="m"}f=b(f);return new RegExp(f,e)}else{return b(g)}},indexOf:function(g,f,e){g=ViString.normalize(g);f=ViString.normalize(f);if(zm.isString(e)&&e.indexOf("i")>-1){g=g.toLowerCase();f=f.toLowerCase()}return f.indexOf(g)},search:function(f,e){e=ViString.normalize(e);f=ViString.normalize(f);return e.search(f)},replace:function(v,g,p){if(v){var f=ViString.normalize(v),h=ViString.normalize(p),n=h.match(f),s=h.search(f);if(n&&n.length>0){var o=n[0],q,m=0;while((q=h.indexOf(o,s))>=0&&m<n.length){var r=p.substr(q,o.length),t=a(f).exec(o),l=new Array(),u=0;for(var k=1;k<t.length;k++){if(t[k]&&zm.isString(t[k])){l[k]=r.substr(o.indexOf(t[k],u),t[k].length);u=r.indexOf(l[k])+l[k].length}else{l[k]=""}}var e=g.replace(/\$(\d)/g,function(j,w){var i=parseInt(w);if(l&&typeof l[i]=="string"){return l[i]}return j});p=p.substr(0,q)+e+p.substr(q+o.length);h=h.replace(o,e);s=q+e.length;m++}}}return p}}})()};
